####################################################################################################################
# Materialist - Spiritualist
####################################################################################################################
# both add modifiers when collecting stuff

# Materialist
# adds the special projects that buff the planet itself
# gives a bunch of research jobs
pw_building_grand_archive = {
    base_buildtime = @pw_building_buildtime
    position_priority = 95
    planet_limit = 1
    can_be_ruined = no
    category = research

    building_sets = {
        government
        research
    }

    prerequisites = {
        pw_tech_materialist_archiving
    }

    potential = {
        exists = owner
        owner = { is_gestalt = no }
        NOT = { has_modifier = slave_colony }
        NOT = { has_modifier = resort_colony }
        # At Stellaris 3.13, research buildings can't be built on Penal Colony.
        NOT = { has_modifier = penal_colony }
        OR = {
            NOT = { merg_is_habitat = yes }
            owner = { is_void_dweller_empire = yes }
        }
    }

    allow = {
        owner = { is_materialist = yes }
        has_major_upgraded_capital = yes
        OR = {
            free_district_slots > 0 # Needs a free district to occupy
            hidden_trigger = { has_modifier = pw_mod_integrated_monuments } #Or corresponding mod
        }
        pw_can_build_planetary_wonder = yes #Check if there is space for the Wonder

        # Empire Unique:
        pw_is_wonder_empire_unique = { WONDER = pw_building_grand_archive }
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost
            exotic_gases = @pw_building_cost_rare
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_grand_archive }
                }
            }
            minerals = @pw_building_cost_extra
        }
        upkeep = {
            energy = @pw_building_upkeep_expensive
            exotic_gases = @pw_building_upkeep_rare_1
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    destroy_trigger = {
        OR = {
            has_modifier = slave_colony
            has_modifier = resort_colony
            # At Stellaris 3.13, research buildings can't be built on Penal Colony.
            has_modifier = penal_colony
            AND = {
                exists = owner
                owner = { is_gestalt = yes }
            }
            # AND = {
            # 	exists = owner
            # 	owner = { is_materialist =  no }
            # }
        }
    }

    convert_to = {
        building_sacred_nexus
        building_heritage_site
        building_holotemple
        building_simulation_2
        building_hive_cluster
        building_corporate_site
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder_empire_unique
    }

    #Grand-Archivist
    triggered_planet_modifier = {
        potential = {
            owner = { is_materialist = yes }
        }
        modifier = {
            job_pw_grand_archivist_add = 600
        }
    }
    #Master Archivist
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                is_materialist = yes
                has_country_flag = pw_grand_archive_holoarchive_master_archivist_appointed
            }
        }
        modifier = {
            job_pw_master_archivist_add = 100
        }
    }

    # for non materialists
    triggered_planet_modifier = {
        potential = {
            owner = {
                is_materialist = no
                # gestalts blow it up
            }
        }
        modifier = {
            job_physicist_add = 200
            job_biologist_add = 200
            job_engineer_add = 200
        }
    }

    #Ambition Bonus
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_researchers_upkeep_mult = -0.10
        }
    }

    triggered_desc = {
        text = pw_building_grand_archive_tooltip
    }

    on_built = {
        planet_event = { id = pw_wonder.1600 }
    }

    ai_weight = {
        weight = 75
        modifier = {
            factor = 0
            buildings_has_exotic_gases = no
            owner = {
                AND = {
                    country_uses_consumer_goods = yes
                    has_monthly_income = {
                        resource = consumer_goods
                        value < 5
                    }
                }
            }
        }
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            exists = owner
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_grand_archive }
            NOT = { has_building_construction = pw_building_grand_archive }
        }
        modifier = {
            factor = 2.5
            is_capital = yes
        }
        modifier = {
            factor = 3
            exists = owner
            owner = { has_ethic = ethic_fanatic_materialist }
        }
        modifier = {
            factor = 2
            has_active_building = building_research_lab_1
        }
        modifier = {
            factor = 3
            OR = {
                has_active_building = building_research_lab_2
                has_active_building = building_research_lab_3
                has_district = district_hab_science
                has_district = district_rw_science
                pw_jobs_any_research = yes
            }
        }
        modifier = {
            factor = 5
            has_research_designation = yes
        }
        modifier = {
            factor = value:pw_pop_factor
        }
    }
}

# Spiritualist
# adds the special projects that have empire modifiers
# gives priest jobs
pw_building_holy_reliquary = {
    base_buildtime = @pw_building_buildtime
    position_priority = 95
    category = unity
    planet_limit = 1
    can_be_ruined = no

    building_sets = {
        government
        unity
    }

    prerequisites = {
        pw_tech_spiritual_artifacts_studies
    }

    potential = {
        exists = owner
        owner = { is_gestalt = no }
        NOT = { has_modifier = slave_colony }
        NOT = { has_modifier = resort_colony }
        OR = {
            NOT = { merg_is_habitat = yes }
            owner = { is_void_dweller_empire = yes }
        }
    }

    allow = {
        owner = { is_spiritualist = yes }
        has_major_upgraded_capital = yes
        OR = {
            free_district_slots > 0 # Needs a free district to occupy
            hidden_trigger = { has_modifier = pw_mod_integrated_monuments } #Or corresponding mod
        }
        pw_can_build_planetary_wonder = yes #Check if there is space for the Wonder

        # Empire Unique:
        pw_is_wonder_empire_unique = { WONDER = pw_building_holy_reliquary }
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost
            rare_crystals = @pw_building_cost_rare
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_holy_reliquary }
                }
            }
            minerals = @pw_building_cost_extra
        }
        upkeep = {
            energy = @pw_building_upkeep_expensive
            rare_crystals = @pw_building_upkeep_rare_1
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    destroy_trigger = {
        OR = {
            has_modifier = slave_colony
            has_modifier = resort_colony
            AND = {
                exists = owner
                owner = { is_gestalt = yes }
            }
            # AND = {
            # 	exists = owner
            # 	owner = { is_spiritualist =  no }
            # }
        }
    }

    convert_to = {
        building_sacred_nexus
        building_heritage_site
        building_holotemple
        building_simulation_2
        building_hive_cluster
        building_corporate_site
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder_empire_unique
    }

    #Relic Keeper
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_spiritualist = yes }
            owner = {
                has_country_flag = pw_holy_reliquary_relic_keeper_appointed
            }
        }
        modifier = {
            job_pw_relic_keeper_add = 100
        }
    }

    # Politician
    # can convert to high priests or technophants
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                is_spiritualist = yes
            }
        }
        modifier = {
            job_politician_add = 100 # high_priest
        }
    }


    # only if spiritualist
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                is_spiritualist = yes
            }
        }
        job_bureaucrat_add = 400
    }

    # if not spiritualist
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                is_spiritualist = no
            }
        }
        job_bureaucrat_add = 200
    }

    # mortal initiates if death priest
    triggered_planet_modifier = {
        potential = {
            exists = owner
            OR = {
                owner = { has_valid_civic = civic_death_cult }
                owner = { has_valid_civic = civic_death_cult_corporate }
            }
        }
        modifier = {
            job_mortal_initiate_add = 200
        }
    }

    #Ambition Bonus
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_bureaucrats_produces_mult = 0.15
        }
    }

    triggered_desc = {
        text = pw_building_holy_reliquary_tooltip
    }


    on_built = {
        planet_event = { id = pw_wonder.1500 }
    }

    ai_weight = {
        weight = 75
        modifier = {
            factor = 0
            buildings_has_crystals = no
            owner = {
                OR = {
                    AND = {
                        country_uses_consumer_goods = yes
                        has_monthly_income = {
                            resource = consumer_goods
                            value < 5
                        }
                    }
                    AND = {
                        country_uses_consumer_goods = no
                        has_monthly_income = {
                            resource = minerals
                            value < 75
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            exists = owner
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_holy_reliquary }
            NOT = { has_building_construction = pw_building_holy_reliquary }
        }
        modifier = {
            factor = 2.5
            is_capital = yes
        }
        modifier = {
            factor = 3
            exists = owner
            owner = { has_ethic = ethic_fanatic_spiritualist }
        }
        # modifier = {
        # 	factor = value:pw_job_factor|JOB|priest|
        # }
        modifier = {
            factor = value:pw_pop_factor
        }
    }
}

####################################################################################################################
# Xenophile - Xenophobe
####################################################################################################################
# both add jobs based on diplomatic status

# Xenophile
# gives extra unity / amenities jobs based on federation size + improve relation
# this one is an upgrade from Pavilion of Wonders
pw_building_fair_of_worlds = {
    base_buildtime = @pw_building_buildtime
    position_priority = 110
    category = unity
    can_be_ruined = no
    can_build = no #Only upgrades

    building_sets = {
        government
        unity
    }

    prerequisites = {
        pw_tech_xeno_art_integration
    }

    potential = {
        exists = owner
        owner = { is_gestalt = no }
        NOT = { has_modifier = slave_colony }
        # At Stellaris 3.13, some unity buildings can't be built on Penal Colony.
        NOT = { has_modifier = penal_colony }

        OR = {
            NOT = { merg_is_habitat = yes }
            owner = { is_void_dweller_empire = yes }
        }
    }

    allow = {
        #Upgrade Wonders don't check for districts or availability
        owner = { is_xenophile = yes }
        has_major_upgraded_capital = yes

        # Empire Unique:
        pw_is_wonder_empire_unique = { WONDER = pw_building_fair_of_worlds }
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost
            rare_crystals = @pw_building_cost_rare
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_fair_of_worlds }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_designation_fair_of_worlds = yes
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep_expensive
            rare_crystals = @pw_building_upkeep_rare_1
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_designation_fair_of_worlds = yes
                }
            }
            energy = @pw_building_upkeep_discount
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    destroy_trigger = {
        OR = {
            has_modifier = slave_colony
            # At Stellaris 3.13, some unity buildings can't be built on Penal Colony.
            has_modifier = penal_colony

            AND = {
                exists = owner
                owner = { is_gestalt = yes }
            }
            # AND = {
            # 	exists = owner
            # 	owner = { is_xenophile = no }
            # }
        }
    }

    convert_to = {
        pw_building_pavilion_of_wonders
        pw_building_museum_of_the_grotesque
        building_heritage_site
        building_holotemple
        building_simulation_2
        building_hive_cluster
        building_corporate_site
        building_galactic_memorial_2
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder
    }

    #Administrator
    planet_modifier = {
        job_politician_add = 100
        job_entertainer_add = 300
        job_bureaucrat_per_pop = @pw_job_per_25_pop
    }

    #Curators of Diversity (Envoys, max 5)
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophile = yes }
            owner = {
                count_envoy = {
                    count > 0
                    limit = {
                        has_envoy_task = { task = improve_relations }
                    }
                }
            }
        }
        modifier = {
            job_pw_diversity_curator_add = 100
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophile = yes }
            owner = {
                count_envoy = {
                    count > 1
                    limit = {
                        has_envoy_task = { task = improve_relations }
                    }
                }
            }
        }
        modifier = {
            job_pw_diversity_curator_add = 100
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophile = yes }
            owner = {
                count_envoy = {
                    count > 2
                    limit = {
                        has_envoy_task = { task = improve_relations }
                    }
                }
            }
        }
        modifier = {
            job_pw_diversity_curator_add = 100
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophile = yes }
            owner = {
                count_envoy = {
                    count > 3
                    limit = {
                        has_envoy_task = { task = improve_relations }
                    }
                }
            }
        }
        modifier = {
            job_pw_diversity_curator_add = 100
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophile = yes }
            owner = {
                count_envoy = {
                    count > 4
                    limit = {
                        has_envoy_task = { task = improve_relations }
                    }
                }
            }
        }
        modifier = {
            job_pw_diversity_curator_add = 100
        }
    }

    #Curators of Diversity (Federation, max 5)
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophile = yes }
            owner = { has_federation = yes }
            owner = {
                count_federation_ally = { count > 0 }
            }
        }
        modifier = {
            job_pw_diversity_curator_add = 100
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophile = yes }
            owner = { has_federation = yes }
            owner = {
                count_federation_ally = { count > 1 }
            }
        }
        modifier = {
            job_pw_diversity_curator_add = 100
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophile = yes }
            owner = { has_federation = yes }
            owner = {
                count_federation_ally = { count > 2 }
            }
        }
        modifier = {
            job_pw_diversity_curator_add = 100
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophile = yes }
            owner = { has_federation = yes }
            owner = {
                count_federation_ally = { count > 3 }
            }
        }
        modifier = {
            job_pw_diversity_curator_add = 100
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophile = yes }
            owner = { has_federation = yes }
            owner = {
                count_federation_ally = { count > 4 }
            }
        }
        modifier = {
            job_pw_diversity_curator_add = 100
        }
    }


    #Ambition Bonus
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_megacorp = no }
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_jobs_unity_produces_mult = 0.05
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_megacorp = yes }
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_traders_produces_mult = 0.10
        }
    }

    triggered_desc = {
        text = pw_building_fair_of_worlds_tooltip
    }

    on_built = {
        planet_event = { id = pw_wonder.1430 }
    }

    ai_weight = {
        weight = 50
        modifier = {
            factor = 0
            buildings_has_crystals = no
            owner = {
                OR = {
                    AND = {
                        country_uses_consumer_goods = yes
                        has_monthly_income = {
                            resource = consumer_goods
                            value < 5
                        }
                    }
                    AND = {
                        country_uses_consumer_goods = no
                        has_monthly_income = {
                            resource = minerals
                            value < 75
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            exists = owner
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_fair_of_worlds }
            NOT = { has_building_construction = pw_building_fair_of_worlds }
        }
        modifier = {
            factor = 2
            has_designation = col_resort
        }
        modifier = {
            factor = 2
            is_capital = yes
        }
        modifier = {
            factor = 2
            exists = owner
            owner = { has_ethic = ethic_fanatic_xenophile }
        }
        modifier = {
            factor = 5
            exists = owner
            owner = {
                any_owned_planet = {
                    NOT = { is_planet = root }
                    OR = {
                        has_active_building = pw_building_pavilion_of_wonders
                        has_active_building = pw_building_fair_of_worlds
                        has_active_building = pw_building_museum_of_the_grotesque
                    }
                }
            }
        }
        modifier = {
            factor = 2
            exists = owner
            owner = {
                OR = {
                    has_megastructure = mega_art_installation_2
                    has_megastructure = mega_art_installation_3
                    has_megastructure = mega_art_installation_4
                    has_megastructure = mega_art_installation_restored
                    has_megastructure = mega_art_installation_restored_2
                }
            }
        }
    }
}

# Xenophobe
# gives extra unity / amenities jobs based on rivalries + harm relation + war
# this one is an upgrade from Pavilion of Wonders
pw_building_museum_of_the_grotesque = {
    base_buildtime = @pw_building_buildtime
    position_priority = 110
    category = unity
    can_be_ruined = no
    can_build = no #Only upgrades

    building_sets = {
        government
        unity
    }

    prerequisites = {
        pw_tech_xeno_art_alienation
    }

    potential = {
        exists = owner
        owner = { is_gestalt = no }
        NOT = { has_modifier = slave_colony }
        # At Stellaris 3.13, some unity buildings can't be built on Penal Colony.
        NOT = { has_modifier = penal_colony }

        OR = {
            NOT = { merg_is_habitat = yes }
            owner = { is_void_dweller_empire = yes }
        }
    }

    allow = {
        #Upgrade Wonders don't check for districts or availability
        owner = { is_xenophobe = yes }
        has_major_upgraded_capital = yes

        # Empire Unique:
        pw_is_wonder_empire_unique = { WONDER = pw_building_museum_of_the_grotesque }
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost
            volatile_motes = @pw_building_cost_rare
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_museum_of_the_grotesque }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_designation_museum_of_the_grotesque = yes
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep_expensive
            volatile_motes = @pw_building_upkeep_rare_1
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_designation_museum_of_the_grotesque = yes
                }
            }
            energy = @pw_building_upkeep_discount
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    destroy_trigger = {
        OR = {
            has_modifier = slave_colony
            # At Stellaris 3.13, some unity buildings can't be built on Penal Colony.
            has_modifier = penal_colony

            AND = {
                exists = owner
                owner = { is_gestalt = yes }
            }
            # AND = {
            # 	exists = owner
            # 	owner = { is_xenophobe = no }
            # }
        }
    }

    convert_to = {
        pw_building_pavilion_of_wonders
        pw_building_fair_of_worlds
        building_heritage_site
        building_holotemple
        building_simulation_2
        building_hive_cluster
        building_corporate_site
        building_galactic_memorial_2
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder
    }

    #Administrator
    planet_modifier = {
        job_politician_add = 100
        job_entertainer_add = 300
        job_bureaucrat_per_pop = @pw_job_per_25_pop
    }

    #Curators of Degeneracy (Envoys, max 5)
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophobe = yes }
            owner = {
                count_envoy = {
                    count > 0
                    limit = {
                        has_envoy_task = { task = harm_relations }
                    }
                }
            }
        }
        modifier = {
            job_pw_degeneracy_curator_add = 100
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophobe = yes }
            owner = {
                count_envoy = {
                    count > 1
                    limit = {
                        has_envoy_task = { task = harm_relations }
                    }
                }
            }
        }
        modifier = {
            job_pw_degeneracy_curator_add = 100
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophobe = yes }
            owner = {
                count_envoy = {
                    count > 2
                    limit = {
                        has_envoy_task = { task = harm_relations }
                    }
                }
            }
        }
        modifier = {
            job_pw_degeneracy_curator_add = 100
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophobe = yes }
            owner = {
                count_envoy = {
                    count > 3
                    limit = {
                        has_envoy_task = { task = harm_relations }
                    }
                }
            }
        }
        modifier = {
            job_pw_degeneracy_curator_add = 100
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophobe = yes }
            owner = {
                count_envoy = {
                    count > 4
                    limit = {
                        has_envoy_task = { task = harm_relations }
                    }
                }
            }
        }
        modifier = {
            job_pw_degeneracy_curator_add = 100
        }
    }

    #Curators of Degeneracy (Rival, max 5)
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophobe = yes }
            owner = {
                count_rival_country = {
                    count > 0
                }
            }
        }
        modifier = {
            job_pw_degeneracy_curator_add = 100
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophobe = yes }
            owner = {
                count_rival_country = {
                    count > 1
                }
            }
        }
        modifier = {
            job_pw_degeneracy_curator_add = 100
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophobe = yes }
            owner = {
                count_rival_country = {
                    count > 2
                }
            }
        }
        modifier = {
            job_pw_degeneracy_curator_add = 100
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophobe = yes }
            owner = {
                count_rival_country = {
                    count > 3
                }
            }
        }
        modifier = {
            job_pw_degeneracy_curator_add = 100
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophobe = yes }
            owner = {
                count_rival_country = {
                    count > 4
                }
            }
        }
        modifier = {
            job_pw_degeneracy_curator_add = 100
        }
    }

    #Curators of Degeneracy (war)
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophobe = yes }
            owner = {
                is_at_war = yes
            }
        }
        modifier = {
            job_pw_degeneracy_curator_add = 300
        }
    }

    #Curators of Degeneracy (no diplomacy)
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_xenophobe = yes }
            owner = {
                OR = {
                    has_valid_civic = civic_fanatic_purifiers
                    has_valid_civic = civic_inwards_perfection
                }
            }
        }
        modifier = {
            job_pw_degeneracy_curator_add = 300
        }
    }

    #Ambition Bonus
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_megacorp = no }
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_jobs_unity_produces_mult = 0.05
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_megacorp = yes }
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_traders_produces_mult = 0.10
        }
    }

    triggered_desc = {
        trigger = {
            exists = owner
            owner = {
                NOR = {
                    has_valid_civic = civic_fanatic_purifiers
                    has_valid_civic = civic_inwards_perfection
                }
            }
        }
        text = pw_building_museum_of_the_grotesque_tooltip
    }

    triggered_desc = {
        trigger = {
            exists = owner
            owner = {
                OR = {
                    has_valid_civic = civic_fanatic_purifiers
                    has_valid_civic = civic_inwards_perfection
                }
            }
        }
        text = pw_building_museum_of_the_grotesque_tooltip_no_diplomacy
    }

    on_built = {
        planet_event = { id = pw_wonder.1460 }
    }

    ai_weight = {
        weight = 50
        modifier = {
            factor = 0
            buildings_has_motes = no
            owner = {
                OR = {
                    AND = {
                        country_uses_consumer_goods = yes
                        has_monthly_income = {
                            resource = consumer_goods
                            value < 5
                        }
                    }
                    AND = {
                        country_uses_consumer_goods = no
                        has_monthly_income = {
                            resource = minerals
                            value < 75
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            exists = owner
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_museum_of_the_grotesque }
            NOT = { has_building_construction = pw_building_museum_of_the_grotesque }
        }
        modifier = {
            factor = 2
            has_designation = col_resort
        }
        modifier = {
            factor = 2
            is_capital = yes
        }
        modifier = {
            factor = 2
            exists = owner
            owner = { has_ethic = ethic_fanatic_xenophobe }
        }
        modifier = {
            factor = 5
            exists = owner
            owner = {
                any_owned_planet = {
                    NOT = { is_planet = root }
                    OR = {
                        has_active_building = pw_building_pavilion_of_wonders
                        has_active_building = pw_building_fair_of_worlds
                        has_active_building = pw_building_museum_of_the_grotesque
                    }
                }
            }
        }
        modifier = {
            factor = 2
            exists = owner
            owner = {
                OR = {
                    has_megastructure = mega_art_installation_2
                    has_megastructure = mega_art_installation_3
                    has_megastructure = mega_art_installation_4
                    has_megastructure = mega_art_installation_restored
                    has_megastructure = mega_art_installation_restored_2
                }
            }
        }
    }
}
