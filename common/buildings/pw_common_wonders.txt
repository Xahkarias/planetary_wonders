
####################################################################################################################
## RESOURCE WONDERS
####################################################################################################################

### MINERALS
##########################
pw_building_erebus_project = {
    base_buildtime = @pw_building_buildtime
    position_priority = 120
    planet_limit = 1
    can_be_ruined = no
    category = resource

    building_sets = {
        government
        mining
    }

    prerequisites = {
        pw_tech_erebus_project
    }

    potential = {
        exists = owner
        NOT = { has_modifier = resort_colony }
        NOT = { merg_is_hab_ringworld = yes }
        OR = {
            NOT = { merg_is_habitat = yes }
            AND = {
                owner = { is_void_dweller_empire = yes }
                has_planet_flag = mining_habitat
            }
        }
    }

    destroy_trigger = {
        OR = {
            has_modifier = resort_colony
            merg_is_arcology = yes
        }
    }

    convert_to = {
        building_mineral_purification_plant
    }

    allow = {
        has_major_upgraded_capital = yes
        OR = {
            free_district_slots > 0 # Needs a free district to occupy
            hidden_trigger = { has_modifier = pw_mod_integrated_monuments } #Or corresponding mod
        }
        pw_can_build_planetary_wonder = yes #Check if there is space for the Wonder
        NOR = {
            has_modifier = pw_mod_gaia_unstable_weather
            has_modifier = resort_colony
            merg_is_arcology = yes
        }
    }

    upgrades = {
        pw_building_erebus_fracking_plant
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost
            alloys  = @pw_building_cost_advanced
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_erebus_project }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    has_mining_designation = yes
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    has_mining_designation = yes
                }
            }
            energy = @pw_building_upkeep_discount
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder
    }

    country_modifier = {
        country_resource_max_minerals_add = 5000
    }
    planet_modifier = {# killed the director jobs
        planet_jobs_minerals_produces_mult = 0.25
    }

    #Add Regular Mining: 1 for each District
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_regular_empire = yes }
        }
        modifier = {
            job_miner_add = 100
        }
        mult = value:pw_mining_value
    }

    #Add Gestalt Mining: 1 for each District
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_mining_drone_add = 100
        }
        mult = value:pw_mining_value
    }

    # subterernean housing
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_origin = origin_subterranean }
        }
        modifier = {
            planet_housing_add = 500
        }
    }

    #Bonus from Ambition
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_jobs_minerals_upkeep_mult = -0.10
        }
    }

    triggered_desc = {
        trigger = {
            owner = { is_regular_empire = yes }
        }
        text = pw_erebus_project_jobs_add_regular
    }

    triggered_desc = {
        trigger = {
            owner = { is_gestalt = yes }
        }
        text = pw_erebus_project_jobs_add_gestalt
    }

    on_built = {
        planet_event = { id = pw_wonder.500 }
    }

    ai_weight = {
        weight = 10
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            exists = owner
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_erebus_project }
            NOT = { has_building_construction = pw_building_erebus_project }
        }
        modifier = {
            factor = 1.5
            exists = owner
            OR = {
                owner = { is_machine_empire = yes }
                owner = { is_lithoid_empire = yes }
            }
        }
        modifier = {
            factor = 10
            has_mining_designation = yes
        }
        # modifier = {
        # 	factor = 5
        # 	OR = {
        # 		has_designation = col_rural
        # 		has_designation = col_rural_gestalt
        # 	}
        # }
        modifier = {
            factor = 2
            districts_good_minerals = yes
        }
        modifier = {
            factor = 5
            exists = owner
            owner = {
                has_monthly_income = {
                    resource = minerals
                    value < 100
                }
            }
        }
        modifier = {
            factor = value:pw_mining_value
        }
        modifier = {
            factor = 1.5
            planet.owner = {
                is_specialist_subject_type = { TYPE = prospectorium }
            }
        }
    }
}

pw_building_erebus_fracking_plant = {
    base_buildtime = @pw_building_buildtime
    position_priority = 115
    can_build = no #Only upgrades
    can_be_ruined = no
    category = resource

    building_sets = {
        government
        mining
    }

    prerequisites = {
        pw_tech_erebus_fracking_plant
    }

    potential = {
        exists = owner
        NOT = { has_modifier = resort_colony }
        NOT = { merg_is_hab_ringworld = yes }
        OR = {
            NOT = { merg_is_habitat = yes }
            AND = {
                owner = { is_void_dweller_empire = yes }
                has_planet_flag = mining_habitat
            }
        }
    }

    destroy_trigger = {
        OR = {
            has_modifier = resort_colony
            merg_is_arcology = yes
        }
    }

    convert_to = {
        building_mineral_purification_hub
    }

    allow = {
        has_major_upgraded_capital = yes
        #Upgrade Wonders don't need to check for availability

        NOR = {
            has_modifier = pw_mod_gaia_unstable_weather
            has_modifier = resort_colony
            merg_is_arcology = yes
        }

        # Empire Unique:
        pw_is_wonder_empire_unique = { WONDER = pw_building_erebus_fracking_plant }
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost_upgrade
            alloys  = @pw_building_cost_advanced
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_erebus_fracking_plant }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    has_mining_designation = yes
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    has_mining_designation = yes
                }
            }
            energy = @pw_building_upkeep_discount
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder_empire_unique
    }

    planet_modifier = {
        planet_translucers_produces_mult = 0.10
        planet_jobs_minerals_produces_mult = 0.50
    }
    country_modifier = {
        country_resource_max_minerals_add = 10000
    }

    #Individual
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_regular_empire = yes }
        }
        modifier = {
            job_translucer_add = 300
        }
    }

    #Gestalt
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_translucer_drone_add = 300
        }
    }

    #Add Regular Mining: 1 for each District
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_regular_empire = yes }
        }
        modifier = {
            job_miner_add = 100
        }
        mult = value:pw_mining_value
    }

    #Add Gestalt Mining: 1 for each District
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_mining_drone_add = 100
        }
        mult = value:pw_mining_value
    }

    # subterreanan housing
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_origin = origin_subterranean }
        }
        modifier = {
            planet_housing_add = 1000
        }
    }

    #Bonus from Ambition
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_jobs_minerals_upkeep_mult = -0.20
            planet_translucers_produces_mult = 0.05
        }
    }

    triggered_desc = {
        trigger = {
            owner = { is_gestalt = no }
        }
        text = pw_erebus_project_jobs_add_regular
    }

    triggered_desc = {
        trigger = {
            owner = { is_gestalt = yes }
        }
        text = pw_erebus_project_jobs_add_gestalt
    }

    on_built = {
        planet_event = { id = pw_wonder.550 }
    }

    ai_weight = {
        weight = 35
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            exists = owner
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_erebus_fracking_plant }
            NOT = { has_building_construction = pw_building_erebus_fracking_plant }
        }
        modifier = {
            factor = 1.5
            exists = owner
            OR = {
                owner = { is_machine_empire = yes }
                owner = { is_lithoid_empire = yes }
            }
        }
        modifier = {
            factor = 5
            has_mining_designation = yes
        }
        # modifier = {
        # 	factor = 3
        # 	OR = {
        # 		has_designation = col_rural
        # 		has_designation = col_rural_gestalt
        # 	}
        # }
        modifier = {
            factor = 2
            districts_good_minerals = yes
        }
        modifier = {
            factor = 2
            exists = owner
            owner = {
                has_monthly_income = {
                    resource = minerals
                    value < 100
                }
            }
        }
        modifier = {
            factor = value:pw_mining_value
        }
        modifier = {
            factor = 1.5
            planet.owner = {
                is_specialist_subject_type = { TYPE = prospectorium }
            }
        }
    }
}

### ENERGY
##########################
pw_building_helios_tower = {
    base_buildtime = @pw_building_buildtime
    position_priority = 120
    planet_limit = 1
    can_be_ruined = no
    category = resource

    building_sets = {
        government
        generator
    }

    prerequisites = {
        pw_tech_helios_tower
    }

    potential = {
        exists = owner
        NOT = { has_modifier = resort_colony }
        NOT = { merg_is_hab_ringworld = yes }
        OR = {
            NOT = { merg_is_habitat = yes }
            AND = {
                owner = { is_void_dweller_empire = yes }
                OR = {
                    has_planet_flag = energy_habitat
                    owner = { is_gestalt = yes }
                }
            }
        }
    }

    destroy_trigger = {
        OR = {
            has_modifier = resort_colony
            merg_is_arcology = yes
        }
    }

    convert_to = {
        building_energy_grid
    }

    allow = {
        has_major_upgraded_capital = yes
        OR = {
            free_district_slots > 0 # Needs a free district to occupy
            hidden_trigger = { has_modifier = pw_mod_integrated_monuments } #Or corresponding mod
        }
        pw_can_build_planetary_wonder = yes #Check if there is space for the Wonder
        NOR = {
            has_modifier = pw_mod_gaia_unstable_weather
            has_modifier = resort_colony
            merg_is_arcology = yes
        }
    }

    upgrades = {
        pw_building_helios_translucent_obelisk
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost
            alloys  = @pw_building_cost_advanced
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_helios_tower }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    has_generator_designation = yes
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    has_generator_designation = yes
                }
            }
            energy = @pw_building_upkeep_discount
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder
    }

    country_modifier = {
        country_resource_max_energy_add = 5000
    }
    planet_modifier = {# killed the director jobs
        planet_jobs_energy_produces_mult = 0.25
    }

    #Add Regular Technician: 1 for each District
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_regular_empire = yes }
        }
        modifier = {
            job_technician_add = 100
        }
        mult = value:pw_generators_value
    }

    #Add Gestalt Technician: 1 for each District
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_technician_drone_add = 100
        }
        mult = value:pw_generators_value
    }


    #Bonus from Ambition
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_buildings_energy_upkeep_mult = -0.20
        }
    }

    triggered_desc = {
        trigger = {
            owner = { is_gestalt = no }
        }
        text = pw_helios_tower_jobs_add_regular
    }

    triggered_desc = {
        trigger = {
            owner = { is_gestalt = yes }
        }
        text = pw_helios_tower_jobs_add_gestalt
    }

    on_built = {
        planet_event = { id = pw_wonder.600 }
    }

    ai_weight = {
        weight = 10
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            exists = owner
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_helios_tower }
            NOT = { has_building_construction = pw_building_helios_tower }
        }
        modifier = {
            factor = 1.5
            exists = owner
            OR = {
                owner = { is_machine_empire = yes }
            }
        }
        modifier = {
            factor = 4
            has_designation = col_generator
        }
        # modifier = {
        # 	factor = 3
        # 	OR = {
        # 		has_designation = col_rural
        # 		has_designation = col_rural_gestalt
        # 	}
        # }
        modifier = {
            factor = 3
            districts_good_energy = yes
        }
        modifier = {
            factor = 4
            exists = owner
            owner = {
                has_monthly_income = {
                    resource = energy
                    value < 100
                }
            }
        }
        modifier = {
            factor = value:pw_generators_value
        }
        modifier = {
            factor = 1.5
            planet.owner = {
                is_specialist_subject_type = { TYPE = prospectorium }
            }
        }
    }
}

pw_building_helios_translucent_obelisk = {
    base_buildtime = @pw_building_buildtime
    position_priority = 115
    can_build = no #Only upgrades
    can_be_ruined = no
    category = resource

    building_sets = {
        government
        generator
    }

    prerequisites = {
        pw_tech_helios_translucent_obelisk
    }

    potential = {
        exists = owner
        NOT = { has_modifier = resort_colony }
        NOT = { merg_is_hab_ringworld = yes }
        OR = {
            NOT = { merg_is_habitat = yes }
            AND = {
                owner = { is_void_dweller_empire = yes }
                OR = {
                    has_planet_flag = energy_habitat
                    owner = { is_gestalt = yes }
                }
            }
        }
    }

    destroy_trigger = {
        OR = {
            has_modifier = resort_colony
            merg_is_arcology = yes
        }
    }

    convert_to = {
        building_energy_nexus
    }

    allow = {
        has_major_upgraded_capital = yes
        #Upgrade Wonders don't need to check for availability

        NOR = {
            has_modifier = pw_mod_gaia_unstable_weather
            has_modifier = resort_colony
            merg_is_arcology = yes
        }

        # Empire Unique:
        pw_is_wonder_empire_unique = { WONDER = pw_building_helios_translucent_obelisk }
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost_upgrade
            alloys  = @pw_building_cost_advanced
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_helios_translucent_obelisk }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    has_generator_designation = yes
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    has_generator_designation = yes
                }
            }
            energy = @pw_building_upkeep_discount
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder_empire_unique
    }

    country_modifier = {
        country_resource_max_energy_add = 10000
    }
    planet_modifier = {
        planet_chemists_produces_mult = 0.10
        planet_jobs_energy_produces_mult = 0.50
    }

    #Individual
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_regular_empire = yes }
        }
        modifier = {
            job_chemist_add = 300
        }
    }

    #Energy coordinator
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_chemist_drone_add = 300
        }
    }

    #Add Regular Technician: 1 for each District
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_regular_empire = yes }
        }
        modifier = {
            job_technician_add = 100
        }
        mult = value:pw_generators_value
    }

    #Add Gestalt Technician: 1 for each District
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_technician_drone_add = 100
        }
        mult = value:pw_generators_value
    }


    #Bonus from Ambition
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_buildings_energy_upkeep_mult = -0.25
            planet_chemists_produces_mult = 0.05
        }
    }

    triggered_desc = {
        trigger = {
            owner = { is_gestalt = no }
        }
        text = pw_helios_tower_jobs_add_regular
    }

    triggered_desc = {
        trigger = {
            owner = { is_gestalt = yes }
        }
        text = pw_helios_tower_jobs_add_gestalt
    }


    on_built = {
        planet_event = { id = pw_wonder.650 }
    }

    ai_weight = {
        weight = 35
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            exists = owner
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_helios_translucent_obelisk }
            NOT = { has_building_construction = pw_building_helios_translucent_obelisk }
        }
        modifier = {
            factor = 1.25
            exists = owner
            OR = {
                owner = { is_machine_empire = yes }
            }
        }
        modifier = {
            factor = 5
            has_designation = col_generator
        }
        # modifier = {
        # 	factor = 3
        # 	OR = {
        # 		has_designation = col_rural
        # 		has_designation = col_rural_gestalt
        # 	}
        # }
        modifier = {
            factor = 2
            districts_good_energy = yes
        }
        modifier = {
            factor = 2
            exists = owner
            owner = {
                has_monthly_income = {
                    resource = energy
                    value < 300
                }
            }
        }
        modifier = {
            factor = value:pw_generators_value
        }
        modifier = {
            factor = 1.5
            planet.owner = {
                is_specialist_subject_type = { TYPE = prospectorium }
            }
        }
    }
}

### FOOD
##########################
pw_building_demetrius_fields = {
    base_buildtime = @pw_building_buildtime
    position_priority = 120
    planet_limit = 1
    can_be_ruined = no
    category = resource

    building_sets = {
        government
        farming
    }

    prerequisites = {
        pw_tech_demetrius_fields
    }

    potential = {
        exists = owner
        NOT = { has_modifier = resort_colony }
        NOT = { merg_is_machine_world = yes }
        NOT = { merg_is_habitat = yes }
    }

    destroy_trigger = {
        OR = {
            has_modifier = resort_colony
            merg_is_arcology = yes
            merg_is_machine_world = yes
        }
    }

    convert_to = {
        building_food_processing_facility
    }

    allow = {
        has_major_upgraded_capital = yes
        OR = {
            free_district_slots > 0 # Needs a free district to occupy
            hidden_trigger = { has_modifier = pw_mod_integrated_monuments } #Or corresponding mod
        }
        pw_can_build_planetary_wonder = yes #Check if there is space for the Wonder
        NOR = {
            has_modifier = pw_mod_gaia_unstable_weather
            has_modifier = resort_colony
            merg_is_arcology = yes
        }
    }

    upgrades = {
        pw_building_demetrius_chemical_garden
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost
            alloys  = @pw_building_cost_advanced
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_demetrius_fields }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    OR = {
                        has_designation = col_farming
                        has_designation = col_ring_farming
                    }
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    OR = {
                        has_designation = col_farming
                        has_designation = col_ring_farming
                    }
                }
            }
            energy = @pw_building_upkeep_discount
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder
    }

    country_modifier = {
        country_resource_max_food_add = 5000
    }
    planet_modifier = {# killed the director jobs
        planet_jobs_food_produces_mult = 0.25
    }

    #Add Regular Farmer: 1 for each District
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_regular_empire = yes }
            farmer_is_angler_trigger = no
        }
        modifier = {
            job_farmer_add = 100
        }
        mult = value:pw_farming_value
    }

    #Add Angler and Pearl Diver: split between artisan and farmer
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_regular_empire = yes }
            farmer_is_angler_trigger = yes
        }
        modifier = {
            job_farmer_add = 50
            job_artisan_add = 50
        }
        mult = value:pw_farming_value
    }

    #Add Gestalt Farmer: 1 for each District
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_agri_drone_add = 100
        }
        mult = value:pw_farming_value
    }

    #Bonus from Ambition
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_pops_organics_food_upkeep_mult = -0.15
        }
    }

    triggered_desc = {
        trigger = {
            exists = owner
            owner = { is_regular_empire = yes }
            farmer_is_angler_trigger = no
        }
        text = pw_demetrius_fields_jobs_add_regular
    }

    triggered_desc = {
        trigger = {
            exists = owner
            owner = { is_regular_empire = yes }
            farmer_is_angler_trigger = yes
        }
        text = pw_demetrius_fields_jobs_add_angler
    }

    triggered_desc = {
        trigger = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        text = pw_demetrius_fields_jobs_add_gestalt
    }

    on_built = {
        planet_event = { id = pw_wonder.700 }
    }

    ai_weight = {
        weight = 10
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            exists = owner
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_demetrius_fields }
            NOT = { has_building_construction = pw_building_demetrius_fields }
        }
        modifier = {
            factor = 0.1
            exists = owner
            OR = {
                owner = { is_machine_empire = yes }
            }
        }
        modifier = {
            factor = 5
            has_designation = col_farming
        }
        # modifier = {
        # 	factor = 3
        # 	OR = {
        # 		has_designation = col_rural
        # 		has_designation = col_rural_gestalt
        # 	}
        # }
        modifier = {
            factor = 2
            districts_good_food = yes
        }
        modifier = {
            factor = 2
            exists = owner
            owner = {
                has_monthly_income = {
                    resource = food
                    value < 100
                }
            }
        }
        modifier = {
            factor = value:pw_farming_value
        }
        modifier = {
            factor = 1.5
            planet.owner = {
                is_specialist_subject_type = { TYPE = prospectorium }
            }
        }
    }
}

pw_building_demetrius_chemical_garden = {
    base_buildtime = @pw_building_buildtime
    position_priority = 115
    can_build = no #Only upgrades
    can_be_ruined = no
    category = resource

    building_sets = {
        government
        farming
    }

    prerequisites = {
        pw_tech_demetrius_chemical_garden
    }

    potential = {
        exists = owner
        NOT = { has_modifier = resort_colony }
        NOT = { merg_is_machine_world = yes }
        NOT = { merg_is_habitat = yes }
    }

    destroy_trigger = {
        OR = {
            has_modifier = resort_colony
            merg_is_arcology = yes
            merg_is_machine_world = yes
        }
    }

    convert_to = {
        building_food_processing_center
    }

    allow = {
        has_major_upgraded_capital = yes
        #Upgrade Wonders don't need to check for availability

        NOR = {
            has_modifier = pw_mod_gaia_unstable_weather
            has_modifier = resort_colony
            merg_is_arcology = yes
        }

        # Empire Unique:
        pw_is_wonder_empire_unique = { WONDER = pw_building_demetrius_chemical_garden }
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost_upgrade
            alloys  = @pw_building_cost_advanced
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_demetrius_chemical_garden }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    OR = {
                        has_designation = col_farming
                        has_designation = col_ring_farming
                    }
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    OR = {
                        has_designation = col_farming
                        has_designation = col_ring_farming
                    }
                }
            }
            energy = @pw_building_upkeep_discount
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder_empire_unique
    }

    country_modifier = {
        country_resource_max_food_add = 10000
    }
    planet_modifier = {
        planet_refiners_produces_mult = 0.10
        planet_jobs_food_produces_mult = 0.50
    }


    #Individual
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_regular_empire = yes }
        }
        modifier = {
            job_gas_refiner_add = 300
        }
    }

    #Gestalt
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_gas_refiner_drone_add = 300
        }
    }

    #Add Regular Farmer: 1 for each District
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_regular_empire = yes }
            farmer_is_angler_trigger = no
        }
        modifier = {
            job_farmer_add = 100
        }
        mult = value:pw_farming_value
    }

    #Add Angler and Pearl Diver: split between artisan and farmer
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_regular_empire = yes }
            farmer_is_angler_trigger = yes
        }
        modifier = {
            job_farmer_add = 50
            job_artisan_add = 50
        }
        mult = value:pw_farming_value
    }

    #Add Gestalt Farmer: 1 for each District
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_agri_drone_add = 100
        }
        mult = value:pw_farming_value
    }

    #Bonus from Ambition
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_pops_organics_food_upkeep_mult = -0.20
            planet_refiners_produces_mult = 0.05
        }
    }


    triggered_desc = {
        trigger = {
            exists = owner
            owner = { is_regular_empire = yes }
            farmer_is_angler_trigger = no
        }
        text = pw_demetrius_fields_jobs_add_regular
    }

    triggered_desc = {
        trigger = {
            exists = owner
            owner = { is_regular_empire = yes }
            farmer_is_angler_trigger = yes
        }
        text = pw_demetrius_fields_jobs_add_angler
    }

    triggered_desc = {
        trigger = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        text = pw_demetrius_fields_jobs_add_gestalt
    }

    on_built = {
        planet_event = { id = pw_wonder.750 }
    }

    ai_weight = {
        weight = 35
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            exists = owner
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_demetrius_chemical_garden }
            NOT = { has_building_construction = pw_building_demetrius_chemical_garden }
        }
        modifier = {
            factor = 0.1
            exists = owner
            OR = {
                owner = { is_machine_empire = yes }
            }
        }
        modifier = {
            factor = 5
            has_designation = col_farming
        }
        # modifier = {
        # 	factor = 3
        # 	OR = {
        # 		has_designation = col_rural
        # 		has_designation = col_rural_gestalt
        # 	}
        # }
        modifier = {
            factor = 2
            districts_good_food = yes
        }
        modifier = {
            factor = 2
            exists = owner
            owner = {
                has_monthly_income = {
                    resource = food
                    value < 100
                }
            }
        }
        modifier = {
            factor = value:pw_farming_value
        }
        modifier = {
            factor = 1.5
            planet.owner = {
                is_specialist_subject_type = { TYPE = prospectorium }
            }
        }
    }
}


####################################################################################################################
## BASELINE UNITY WONDER
####################################################################################################################

# AVAILABLE TO ALL INDIVIDUALIST
pw_building_pavilion_of_wonders = {
    base_buildtime = @pw_building_buildtime
    position_priority = 120
    category = unity
    planet_limit = 1
    can_be_ruined = no

    building_sets = {
        government
        unity
    }

    prerequisites = {
        pw_tech_great_art_exhibition
    }

    potential = {
        exists = owner
        owner = { is_gestalt = no }
        NOT = { has_modifier = slave_colony }
        # At Stellaris 3.13, some unity buildings can't be built on Penal Colony.
        NOT = { has_modifier = penal_colony }

        OR = {
            NOT = { merg_is_habitat = yes }
            owner = { is_void_dweller_empire = yes }
        }
    }

    allow = {
        has_major_upgraded_capital = yes
        OR = {
            free_district_slots > 0 # Needs a free district to occupy
            hidden_trigger = { has_modifier = pw_mod_integrated_monuments } #Or corresponding mod
        }
        pw_can_build_planetary_wonder = yes #Check if there is space for the Wonder
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost
            exotic_gases = @pw_building_cost_rare
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_pavilion_of_wonders }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_designation_fair_of_worlds = yes
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep
            exotic_gases = @pw_building_upkeep_rare_1
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_designation_fair_of_worlds = yes
                }
            }
            energy = @pw_building_upkeep_discount
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    destroy_trigger = {
        OR = {
            has_modifier = slave_colony
            # At Stellaris 3.13, some unity buildings can't be built on Penal Colony.
            has_modifier = penal_colony

            AND = {
                exists = owner
                owner = { is_gestalt = yes }
            }
        }
    }

    convert_to = {
        building_heritage_site
        building_holotemple
        building_simulation_2
        building_hive_cluster
        building_corporate_site
        building_galactic_memorial_2
    }

    upgrades = {
        pw_building_fair_of_worlds
        pw_building_museum_of_the_grotesque
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder
    }

    #Administrator
    planet_modifier = {
        job_entertainer_add = 200
        job_bureaucrat_per_pop = @pw_job_per_25_pop
    }
    inline_script = {
        script = jobs/politician_add
        AMOUNT = 100
    }

    #Ambition Bonus
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_megacorp = no }
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_jobs_unity_produces_mult = 0.05
        }
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_megacorp = yes }
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_traders_produces_mult = 0.10
        }
    }

    on_built = {
        planet_event = { id = pw_wonder.1400 }
    }

    ai_weight = {
        weight = 40
        modifier = {
            factor = 0
            buildings_has_exotic_gases = no
            owner = {
                OR = {
                    AND = {
                        country_uses_consumer_goods = yes
                        has_monthly_income = {
                            resource = consumer_goods
                            value < 5
                        }
                    }
                    AND = {
                        country_uses_consumer_goods = no
                        has_monthly_income = {
                            resource = minerals
                            value < 75
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            exists = owner
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_pavilion_of_wonders }
            NOT = { has_building_construction = pw_building_pavilion_of_wonders }
        }
        modifier = {
            factor = 2
            has_designation = col_resort
        }
        modifier = {
            factor = 2
            is_capital = yes
        }
        modifier = {
            factor = 2
            exists = owner
            owner = {
                OR = {
                    is_xenophile = yes
                    is_xenophobe = yes
                }
            }
        }
        modifier = {
            factor = 2
            exists = owner
            owner = {
                OR = {
                    has_ethic = ethic_fanatic_xenophile
                    has_ethic = ethic_fanatic_xenophobe
                }
            }
        }
        modifier = {
            factor = 5
            exists = owner
            owner = {
                any_owned_planet = {
                    NOT = { is_planet = root }
                    OR = {
                        has_active_building = pw_building_pavilion_of_wonders
                        has_active_building = pw_building_fair_of_worlds
                        has_active_building = pw_building_museum_of_the_grotesque
                    }
                }
            }
        }
        modifier = {
            factor = 2
            exists = owner
            owner = {
                OR = {
                    has_megastructure = mega_art_installation_2
                    has_megastructure = mega_art_installation_3
                    has_megastructure = mega_art_installation_4
                    has_megastructure = mega_art_installation_restored
                    has_megastructure = mega_art_installation_restored_2
                }
            }
        }
    }
}

####################################################################################################################
# RESEARCH WONDERS
####################################################################################################################

### PHYSICS
##########################
pw_building_particle_supercollider = {
    base_buildtime = @pw_building_buildtime
    position_priority = 100
    planet_limit = 1
    can_be_ruined = no
    category = research

    building_sets = {
        government
        research
        physics
    }

    prerequisites = {
        pw_tech_particle_supercollider
    }

    potential = {
        exists = owner
        NOT = { has_modifier = resort_colony }
        NOT = { has_modifier = slave_colony }
        # At Stellaris 3.13, research buildings can't be built on Penal Colony.
        NOT = { has_modifier = penal_colony }
        OR = {
            NOT = { merg_is_habitat = yes }
            owner = { is_void_dweller_empire = yes }
        }
    }

    allow = {
        has_major_upgraded_capital = yes
        OR = {
            free_district_slots > 0 # Needs a free district to occupy
            hidden_trigger = { has_modifier = pw_mod_integrated_monuments } #Or corresponding mod
        }
        pw_can_build_planetary_wonder = yes #Check if there is space for the Wonder

        # Empire Unique:
        pw_is_wonder_empire_unique = { WONDER = pw_building_particle_supercollider }
    }

    destroy_trigger = {
        OR = {
            has_modifier = slave_colony
            has_modifier = resort_colony
            # At Stellaris 3.13, research buildings can't be built on Penal Colony.
            has_modifier = penal_colony
        }
    }

    convert_to = {
        building_research_lab_1
    }

    upgrades = {
        pw_building_interdimensional_collider
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost
            volatile_motes = @pw_building_cost_rare
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_particle_supercollider }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    has_research_designation = yes
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep
            volatile_motes = @pw_building_upkeep_rare_1
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    has_research_designation = yes
                }
            }
            energy = @pw_building_upkeep_discount
        }
        upkeep = {
            trigger = {
                exists = planet.owner
                planet.owner = {
                    is_specialist_subject_type = { TYPE = scholarium }
                }
            }
            energy = -2
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder_empire_unique
    }

    #Individuals get 100 politicians
    inline_script = {
        script = jobs/politician_add
        AMOUNT = 100
    }
    #Gestalts get 150 of synapse or coordinator (job swap)
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_coordinator_add = 150
        }
    }

    inline_script = {
        script = pw/research_wonder_t1_jobs
        JOB_NAME_SCRIPT = physicists
        JOB = physicist
        EXPERIMENT_TAG = pw_particle_supercollider_experiment_completed
    }

    #Ambition Bonus
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_jobs_physics_research_produces_mult = @pw_building_research_mod
        }
    }

    on_built = {
        planet_event = { id = pw_wonder.200 }
    }

    ai_weight = {
        weight = 75
        modifier = {
            factor = 0
            buildings_has_crystals = no
            owner = {
                OR = {
                    AND = {
                        country_uses_consumer_goods = yes
                        has_monthly_income = {
                            resource = consumer_goods
                            value < 5
                        }
                    }
                    AND = {
                        country_uses_consumer_goods = no
                        has_monthly_income = {
                            resource = minerals
                            value < 75
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_particle_supercollider }
            NOT = { has_building_construction = pw_building_particle_supercollider }
        }
        modifier = {
            factor = 2
            has_active_building = building_research_lab_1
        }
        modifier = {
            factor = 3
            OR = {
                has_active_building = building_research_lab_2
                has_active_building = building_research_lab_3
                has_district = district_hab_science
                has_district = district_rw_science
                # num_pops_with_job_tag = {
                total_workforce_with_job_tag = {
                    value > 0
                    tags = { research }
                }
                pw_jobs_any_research = yes
            }
        }
        modifier = {
            factor = 5
            has_research_designation = yes
        }
        modifier = {
            factor = 1.5
            owner = {
                any_owned_planet = {
                    OR = {
                        has_active_building = pw_building_domed_city
                        has_active_building = pw_building_secluded_sector
                        has_active_building = pw_building_abyssal_crater_test_site
                        has_active_building = pw_building_abyssal_crater_test_site_habitat
                    }
                }
            }
        }
        modifier = {
            factor = 0.75
            planet_size < 15
        }
        modifier = {
            factor = 1.5
            planet_size > 20
        }
        modifier = {
            factor = 2
            planet.owner = {
                is_specialist_subject_type = { TYPE = scholarium }
            }
        }
    }
}

pw_building_interdimensional_collider = {
    base_buildtime = @pw_building_buildtime
    category = research
    can_build = no #Only upgrades
    can_be_ruined = no
    position_priority = 100

    building_sets = {
        government
        research
        physics
    }

    prerequisites = {
        pw_tech_interdimensional_collider
    }

    potential = {
        exists = owner
        NOT = { has_modifier = resort_colony }
        NOT = { has_modifier = slave_colony }
        # At Stellaris 3.13, research buildings can't be built on Penal Colony.
        NOT = { has_modifier = penal_colony }
        OR = {
            NOT = { merg_is_habitat = yes }
            owner = { is_void_dweller_empire = yes }
        }
    }

    allow = {
        has_major_upgraded_capital = yes
        #Upgrade Wonders don't need to check for availability

        # Empire Unique:
        pw_is_wonder_empire_unique = { WONDER = pw_building_interdimensional_collider }
    }

    destroy_trigger = {
        OR = {
            has_modifier = slave_colony
            has_modifier = resort_colony
            # At Stellaris 3.13, research buildings can't be built on Penal Colony.
            has_modifier = penal_colony
        }
    }

    convert_to = {
        building_research_lab_2
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost_upgrade
            sr_dark_matter = @pw_building_cost_rare_half
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_interdimensional_collider }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    has_research_designation = yes
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep
            rare_crystals = @pw_building_upkeep_rare_1
            sr_dark_matter = @pw_building_upkeep_rare_1
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    has_research_designation = yes
                }
            }
            energy = @pw_building_upkeep_discount
        }
        upkeep = {
            trigger = {
                exists = planet.owner
                planet.owner = {
                    is_specialist_subject_type = { TYPE = scholarium }
                }
            }
            energy = -2
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder_empire_unique
    }

    # produces mult
    planet_modifier = {
        planet_jobs_physics_research_produces_mult = @pw_building_research_upgrade_mod
        physicist_jobs_bonus_workforce_mult = 0.15
    }

    #Regular jobs
    inline_script = {
        script = jobs/politician_add
        AMOUNT = 200
    }
    #Gestalt Jobs
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_coordinator_add = 300
        }
    }

    # 1500 physicists
    inline_script = {
        script = jobs/physicists_add
        AMOUNT = 1500
    }

    #Ambition Bonus
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_jobs_physics_research_produces_mult = @pw_building_research_mod
        }
    }

    on_built = {
        planet_event = { id = pw_wonder.250 }
    }

    ai_weight = {
        weight = 75
        modifier = {
            factor = 0
            buildings_has_crystals = no
            owner = {
                OR = {
                    AND = {
                        country_uses_consumer_goods = yes
                        has_monthly_income = {
                            resource = consumer_goods
                            value < 5
                        }
                    }
                    AND = {
                        country_uses_consumer_goods = no
                        has_monthly_income = {
                            resource = minerals
                            value < 75
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_interdimensional_collider }
            NOT = { has_building_construction = pw_building_interdimensional_collider }
        }
        modifier = {
            factor = 2
            has_active_building = building_research_lab_1
        }
        modifier = {
            factor = 3
            OR = {
                has_active_building = building_research_lab_2
                has_active_building = building_research_lab_3
                has_district = district_hab_science
                has_district = district_rw_science
                pw_jobs_any_research = yes
            }
        }
        modifier = {
            factor = 5
            has_research_designation = yes
        }
        modifier = {
            factor = 1.25
            owner = {
                any_owned_planet = {
                    OR = {
                        has_active_building = pw_building_domed_city
                        has_active_building = pw_building_secluded_sector
                        has_active_building = pw_building_abyssal_crater_test_site
                        has_active_building = pw_building_abyssal_crater_test_site_habitat
                    }
                }
            }
        }
        modifier = {
            factor = 0.75
            planet_size < 15
        }
        modifier = {
            factor = 1.5
            planet_size > 20
        }
        modifier = {
            factor = 2
            planet.owner = {
                is_specialist_subject_type = { TYPE = scholarium }
            }
        }
    }
}

### SOCIETY
##########################
pw_building_domed_city = {
    base_buildtime = @pw_building_buildtime
    position_priority = 100
    planet_limit = 1
    can_be_ruined = no
    category = research

    building_sets = {
        government
        research
        society
    }

    prerequisites = {
        pw_tech_domed_city
    }

    potential = {
        exists = owner
        NOT = { has_modifier = resort_colony }
        NOT = { has_modifier = slave_colony }
        # At Stellaris 3.13, research buildings can't be built on Penal Colony.
        NOT = { has_modifier = penal_colony }
        NOT = { merg_is_habitat = yes }
    }

    allow = {
        has_major_upgraded_capital = yes
        OR = {
            free_district_slots > 0 # Needs a free district to occupy
            hidden_trigger = { has_modifier = pw_mod_integrated_monuments } #Or corresponding mod
        }
        pw_can_build_planetary_wonder = yes #Check if there is space for the Wonder

        # Empire Unique:
        AND = {
            pw_is_wonder_empire_unique = { WONDER = pw_building_domed_city }
            hidden_trigger = { pw_is_wonder_empire_unique = { WONDER = pw_building_secluded_sector }}
        }
    }

    upgrades = {
        pw_building_psionic_observatory
    }

    destroy_trigger = {
        OR = {
            has_modifier = slave_colony
            has_modifier = resort_colony
            # At Stellaris 3.13, research buildings can't be built on Penal Colony.
            has_modifier = penal_colony
        }
    }

    convert_to = {
        building_research_lab_1
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost
            exotic_gases = @pw_building_cost_rare
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_domed_city }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    has_research_designation = yes
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep
            exotic_gases = @pw_building_upkeep_rare_1
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    has_research_designation = yes
                }
            }
            energy = @pw_building_upkeep_discount
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder_empire_unique
    }

    #Individuals get 100 politicians
    inline_script = {
        script = jobs/politician_add
        AMOUNT = 100
    }
    #Gestalts get 150 of synapse or coordinator (job swap)
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_coordinator_add = 150
        }
    }

    inline_script = {
        script = pw/research_wonder_t1_jobs
        JOB_NAME_SCRIPT = biologists
        JOB = biologist
        EXPERIMENT_TAG = pw_domed_city_experiment_completed
    }

    #Ambition Bonus
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_jobs_society_research_produces_mult = @pw_building_research_mod
        }
    }

    on_built = {
        planet_event = { id = pw_wonder.300 }
    }

    ai_weight = {
        weight = 75
        modifier = {
            factor = 0
            buildings_has_exotic_gases = no
            owner = {
                OR = {
                    AND = {
                        country_uses_consumer_goods = yes
                        has_monthly_income = {
                            resource = consumer_goods
                            value < 5
                        }
                    }
                    AND = {
                        country_uses_consumer_goods = no
                        has_monthly_income = {
                            resource = minerals
                            value < 75
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_domed_city }
            NOT = { has_building_construction = pw_building_domed_city }
        }
        modifier = {
            factor = 2
            has_active_building = building_research_lab_1
        }
        modifier = {
            factor = 3
            OR = {
                has_active_building = building_research_lab_2
                has_active_building = building_research_lab_3
                has_district = district_hab_science
                has_district = district_rw_science
                pw_jobs_any_research = yes
            }
        }
        modifier = {
            factor = 5
            has_research_designation = yes
        }
        modifier = {
            factor = 1.25
            owner = {
                any_owned_planet = {
                    OR = {
                        has_active_building = pw_building_particle_supercollider
                        has_active_building = pw_building_abyssal_crater_test_site
                        has_active_building = pw_building_abyssal_crater_test_site_habitat
                    }
                }
            }
        }
        modifier = {
            factor = 0.75
            planet_size < 15
        }
        modifier = {
            factor = 1.5
            planet_size > 20
        }
        modifier = {
            factor = 1.5
            planet.owner = {
                is_specialist_subject_type = { TYPE = scholarium }
            }
        }
    }
}

pw_building_secluded_sector = {
    base_buildtime = @pw_building_buildtime
    position_priority = 100
    planet_limit = 1
    can_be_ruined = no
    icon = pw_building_domed_city
    show_tech_unlock_if = { owner = { is_void_dweller_empire = yes }}
    category = research

    building_sets = {
        government
        research
        society
    }

    prerequisites = {
        pw_tech_domed_city
    }

    potential = {
        exists = owner
        merg_is_habitat = yes
        owner = { is_void_dweller_empire = yes }
    }

    allow = {
        has_major_upgraded_capital = yes
        OR = {
            free_district_slots > 0 # Needs a free district to occupy
            hidden_trigger = { has_modifier = pw_mod_integrated_monuments } #Or corresponding mod
        }
        pw_can_build_planetary_wonder = yes #Check if there is space for the Wonder

        # Empire Unique:
        AND = {
            pw_is_wonder_empire_unique = { WONDER = pw_building_domed_city }
            hidden_trigger = { pw_is_wonder_empire_unique = { WONDER = pw_building_secluded_sector }}
        }
    }

    upgrades = {
        pw_building_psionic_observatory
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost
            exotic_gases = @pw_building_cost_rare
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_secluded_sector }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    has_research_designation = yes
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep
            exotic_gases = @pw_building_upkeep_rare_1
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    has_research_designation = yes
                }
            }
            energy = @pw_building_upkeep_discount
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder_empire_unique
    }

    #Individuals get 100 politicians
    inline_script = {
        script = jobs/politician_add
        AMOUNT = 100
    }
    #Gestalts get 150 of synapse or coordinator (job swap)
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_coordinator_add = 150
        }
    }

    inline_script = {
        script = pw/research_wonder_t1_jobs
        JOB_NAME_SCRIPT = biologists
        JOB = biologist
        EXPERIMENT_TAG = pw_domed_city_experiment_completed
    }

    #Ambition Bonus
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_jobs_society_research_produces_mult = @pw_building_research_mod
        }
    }

    on_built = {
        planet_event = { id = pw_wonder.300 }
    }

    ai_weight = {
        weight = 75
        modifier = {
            factor = 0
            buildings_has_exotic_gases = no
            owner = {
                OR = {
                    AND = {
                        country_uses_consumer_goods = yes
                        has_monthly_income = {
                            resource = consumer_goods
                            value < 5
                        }
                    }
                    AND = {
                        country_uses_consumer_goods = no
                        has_monthly_income = {
                            resource = minerals
                            value < 75
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_secluded_sector }
            NOT = { has_building_construction = pw_building_secluded_sector }
        }
        modifier = {
            factor = 2
            has_active_building = building_research_lab_1
        }
        modifier = {
            factor = 3
            OR = {
                has_active_building = building_research_lab_2
                has_active_building = building_research_lab_3
                has_district = district_hab_science
                has_district = district_rw_science
                pw_jobs_any_research = yes
            }
        }
        modifier = {
            factor = 5
            has_research_designation = yes
        }
        modifier = {
            factor = 1.25
            owner = {
                any_owned_planet = {
                    OR = {
                        has_active_building = pw_building_particle_supercollider
                        has_active_building = pw_building_abyssal_crater_test_site
                        has_active_building = pw_building_abyssal_crater_test_site_habitat
                    }
                }
            }
        }
        modifier = {
            factor = 0.75
            planet_size < 15
        }
        modifier = {
            factor = 1.5
            planet_size > 20
        }
        modifier = {
            factor = 1.5
            planet.owner = {
                is_specialist_subject_type = { TYPE = scholarium }
            }
        }
    }
}

pw_building_psionic_observatory = {
    base_buildtime = @pw_building_buildtime
    category = research
    can_build = no #Only upgrades
    can_be_ruined = no
    position_priority = 100

    building_sets = {
        government
        research
        society
    }

    prerequisites = {
        pw_tech_psionic_observatory
    }

    potential = {
        exists = owner
        NOT = { has_modifier = resort_colony }
        NOT = { has_modifier = slave_colony }
        # At Stellaris 3.13, research buildings can't be built on Penal Colony.
        NOT = { has_modifier = penal_colony }
        OR = {
            NOT = { merg_is_habitat = yes }
            owner = { is_void_dweller_empire = yes }
        }
    }

    allow = {
        has_major_upgraded_capital = yes
        #Upgrade Wonders don't need to check for availability

        # Empire Unique:
        pw_is_wonder_empire_unique = { WONDER = pw_building_psionic_observatory }
    }

    destroy_trigger = {
        OR = {
            has_modifier = slave_colony
            has_modifier = resort_colony
            # At Stellaris 3.13, research buildings can't be built on Penal Colony.
            has_modifier = penal_colony
        }
    }

    convert_to = {
        building_research_lab_2
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost_upgrade
            sr_zro = @pw_building_cost_rare_half
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_psionic_observatory }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    has_research_designation = yes
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep
            exotic_gases = @pw_building_upkeep_rare_1
            sr_zro = @pw_building_upkeep_rare_1
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    has_research_designation = yes
                }
            }
            energy = @pw_building_upkeep_discount
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder_empire_unique
    }

    # produces mult
    planet_modifier = {
        planet_jobs_society_research_produces_mult = @pw_building_research_upgrade_mod
        biologist_jobs_bonus_workforce_mult = 0.15
    }

    #Regular jobs
    inline_script = {
        script = jobs/politician_add
        AMOUNT = 200
    }
    #Gestalt Jobs
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_coordinator_add = 300
        }
    }

    # 1500 biologists
    inline_script = {
        script = jobs/biologists_add
        AMOUNT = 1500
    }

    #Ambition Bonus
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_jobs_society_research_produces_mult = @pw_building_research_mod
        }
    }

    on_built = {
        planet_event = { id = pw_wonder.350 }
    }

    ai_weight = {
        weight = 75
        modifier = {
            factor = 0
            buildings_has_exotic_gases = no
            owner = {
                OR = {
                    AND = {
                        country_uses_consumer_goods = yes
                        has_monthly_income = {
                            resource = consumer_goods
                            value < 5
                        }
                    }
                    AND = {
                        country_uses_consumer_goods = no
                        has_monthly_income = {
                            resource = minerals
                            value < 75
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_psionic_observatory }
            NOT = { has_building_construction = pw_building_psionic_observatory }
        }
        modifier = {
            factor = 2
            has_active_building = building_research_lab_1
        }
        modifier = {
            factor = 3
            OR = {
                has_active_building = building_research_lab_2
                has_active_building = building_research_lab_3
                has_district = district_hab_science
                has_district = district_rw_science
                pw_jobs_any_research = yes
            }
        }
        modifier = {
            factor = 5
            has_research_designation = yes
        }
        modifier = {
            factor = 1.25
            owner = {
                any_owned_planet = {
                    OR = {
                        has_active_building = pw_building_particle_supercollider
                        has_active_building = pw_building_abyssal_crater_test_site
                        has_active_building = pw_building_abyssal_crater_test_site_habitat
                    }
                }
            }
        }
        modifier = {
            factor = 0.75
            planet_size < 15
        }
        modifier = {
            factor = 1.5
            planet_size > 20
        }
        modifier = {
            factor = 1.5
            planet.owner = {
                is_specialist_subject_type = { TYPE = scholarium }
            }
        }
    }
}

### ENGINEERING
##########################
pw_building_abyssal_crater_test_site = {
    base_buildtime = @pw_building_buildtime
    position_priority = 100
    planet_limit = 1
    can_be_ruined = no
    category = research

    building_sets = {
        government
        research
        engineering
    }

    prerequisites = {
        pw_tech_abyssal_crater_test_site
    }

    potential = {
        exists = owner
        NOT = { has_modifier = resort_colony }
        NOT = { has_modifier = slave_colony }
        # At Stellaris 3.13, research buildings can't be built on Penal Colony.
        NOT = { has_modifier = penal_colony }
        NOT = { merg_is_habitat = yes }
    }

    allow = {
        has_major_upgraded_capital = yes
        OR = {
            free_district_slots > 0 # Needs a free district to occupy
            hidden_trigger = { has_modifier = pw_mod_integrated_monuments } #Or corresponding mod
        }
        pw_can_build_planetary_wonder = yes #Check if there is space for the Wonder

        # Empire Unique:
        AND = {
            pw_is_wonder_empire_unique = { WONDER = pw_building_abyssal_crater_test_site }
            hidden_trigger = { pw_is_wonder_empire_unique = { WONDER = pw_building_abyssal_crater_test_site_habitat }}
        }
    }

    upgrades = {
        pw_building_metal_vivarium
    }

    destroy_trigger = {
        OR = {
            has_modifier = slave_colony
            has_modifier = resort_colony
            # At Stellaris 3.13, research buildings can't be built on Penal Colony.
            has_modifier = penal_colony
        }
    }

    convert_to = {
        building_research_lab_1
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost
            rare_crystals = @pw_building_cost_rare
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_abyssal_crater_test_site }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    has_research_designation = yes
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep
            rare_crystals = @pw_building_upkeep_rare_1
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    has_research_designation = yes
                }
            }
            energy = @pw_building_upkeep_discount
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder_empire_unique
    }

    #Individuals get 100 politicians
    inline_script = {
        script = jobs/politician_add
        AMOUNT = 100
    }
    #Gestalts get 150 of synapse or coordinator (job swap)
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_coordinator_add = 150
        }
    }

    inline_script = {
        script = pw/research_wonder_t1_jobs
        JOB_NAME_SCRIPT = engineers
        JOB = engineer
        EXPERIMENT_TAG = pw_abyssal_crater_test_site_experiment_completed
    }

    #Ambition Bonus
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_jobs_engineering_research_produces_mult = @pw_building_research_mod
        }
    }

    on_built = {
        planet_event = { id = pw_wonder.400 }
    }

    ai_weight = {
        weight = 75
        modifier = {
            factor = 0
            buildings_has_motes = no
            owner = {
                OR = {
                    AND = {
                        country_uses_consumer_goods = yes
                        has_monthly_income = {
                            resource = consumer_goods
                            value < 5
                        }
                    }
                    AND = {
                        country_uses_consumer_goods = no
                        has_monthly_income = {
                            resource = minerals
                            value < 75
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_abyssal_crater_test_site }
            NOT = { has_building_construction = pw_building_abyssal_crater_test_site }
        }
        modifier = {
            factor = 2
            has_active_building = building_research_lab_1
        }
        modifier = {
            factor = 3
            OR = {
                has_active_building = building_research_lab_2
                has_active_building = building_research_lab_3
                has_district = district_hab_science
                has_district = district_rw_science
                pw_jobs_any_research = yes
            }
        }
        modifier = {
            factor = 5
            has_research_designation = yes
        }
        modifier = {
            factor = 1.25
            owner = {
                any_owned_planet = {
                    OR = {
                        has_active_building = pw_building_particle_supercollider
                        has_active_building = pw_building_domed_city
                        has_active_building = pw_building_secluded_sector
                    }
                }
            }
        }
        modifier = {
            factor = 0.75
            planet_size < 15
        }
        modifier = {
            factor = 1.5
            planet_size > 20
        }
        modifier = {
            factor = 1.5
            planet.owner = {
                is_specialist_subject_type = { TYPE = scholarium }
            }
        }
    }
}

pw_building_abyssal_crater_test_site_habitat = {
    base_buildtime = @pw_building_buildtime
    position_priority = 100
    planet_limit = 1
    can_be_ruined = no
    icon = pw_building_abyssal_crater_test_site
    show_tech_unlock_if = { owner = { is_void_dweller_empire = yes }}
    category = research

    building_sets = {
        government
        research
        engineering
    }

    prerequisites = {
        pw_tech_abyssal_crater_test_site
    }

    potential = {
        exists = owner
        merg_is_habitat = yes
        owner = { is_void_dweller_empire = yes }
    }

    allow = {
        has_major_upgraded_capital = yes
        OR = {
            free_district_slots > 0 # Needs a free district to occupy
            hidden_trigger = { has_modifier = pw_mod_integrated_monuments } #Or corresponding mod
        }
        pw_can_build_planetary_wonder = yes #Check if there is space for the Wonder

        # Empire Unique:
        AND = {
            pw_is_wonder_empire_unique = { WONDER = pw_building_abyssal_crater_test_site }
            hidden_trigger = { pw_is_wonder_empire_unique = { WONDER = pw_building_abyssal_crater_test_site_habitat }}
        }
    }

    upgrades = {
        pw_building_metal_vivarium
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost
            rare_crystals = @pw_building_cost_rare
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_abyssal_crater_test_site_habitat }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    has_research_designation = yes
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep
            volatile_motes = @pw_building_upkeep_rare_1
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    has_research_designation = yes
                }
            }
            energy = @pw_building_upkeep_discount
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder_empire_unique
    }

    #Individuals get 100 politicians
    inline_script = {
        script = jobs/politician_add
        AMOUNT = 100
    }
    #Gestalts get 150 of synapse or coordinator (job swap)
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_coordinator_add = 150
        }
    }

    inline_script = {
        script = pw/research_wonder_t1_jobs
        JOB_NAME_SCRIPT = engineers
        JOB = engineer
        EXPERIMENT_TAG = pw_abyssal_crater_test_site_experiment_completed
    }

    #Ambition Bonus
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_jobs_engineering_research_produces_mult = @pw_building_research_mod
        }
    }

    on_built = {
        planet_event = { id = pw_wonder.400 }
    }

    ai_weight = {
        weight = 75
        modifier = {
            factor = 0
            buildings_has_motes = no
            owner = {
                OR = {
                    AND = {
                        country_uses_consumer_goods = yes
                        has_monthly_income = {
                            resource = consumer_goods
                            value < 5
                        }
                    }
                    AND = {
                        country_uses_consumer_goods = no
                        has_monthly_income = {
                            resource = minerals
                            value < 75
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_abyssal_crater_test_site_habitat }
            NOT = { has_building_construction = pw_building_abyssal_crater_test_site_habitat }
        }
        modifier = {
            factor = 2
            has_active_building = building_research_lab_1
        }
        modifier = {
            factor = 3
            OR = {
                has_active_building = building_research_lab_2
                has_active_building = building_research_lab_3
                has_district = district_hab_science
                has_district = district_rw_science
                pw_jobs_any_research = yes
            }
        }
        modifier = {
            factor = 5
            has_research_designation = yes
        }
        modifier = {
            factor = 1.25
            owner = {
                any_owned_planet = {
                    OR = {
                        has_active_building = pw_building_particle_supercollider
                        has_active_building = pw_building_domed_city
                        has_active_building = pw_building_secluded_sector
                    }
                }
            }
        }
        modifier = {
            factor = 0.75
            planet_size < 15
        }
        modifier = {
            factor = 1.5
            planet_size > 20
        }
        modifier = {
            factor = 1.5
            planet.owner = {
                is_specialist_subject_type = { TYPE = scholarium }
            }
        }
    }
}

pw_building_metal_vivarium = {
    base_buildtime = @pw_building_buildtime
    category = research
    can_build = no #Only upgrades
    can_be_ruined = no
    position_priority = 100

    building_sets = {
        government
        research
        engineering
    }

    prerequisites = {
        pw_tech_metal_vivarium
    }

    potential = {
        exists = owner
        NOT = { has_modifier = resort_colony }
        NOT = { has_modifier = slave_colony }
        # At Stellaris 3.13, research buildings can't be built on Penal Colony.
        NOT = { has_modifier = penal_colony }
        OR = {
            NOT = { merg_is_habitat = yes }
            owner = { is_void_dweller_empire = yes }
        }
    }

    allow = {
        has_major_upgraded_capital = yes
        #Upgrade Wonders don't need to check for availability

        # Empire Unique:
        pw_is_wonder_empire_unique = { WONDER = pw_building_metal_vivarium }
    }

    destroy_trigger = {
        OR = {
            has_modifier = slave_colony
            has_modifier = resort_colony
            # At Stellaris 3.13, research buildings can't be built on Penal Colony.
            has_modifier = penal_colony
        }
    }

    convert_to = {
        building_research_lab_2
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost_upgrade
            sr_living_metal = @pw_building_cost_rare_half
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_metal_vivarium }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    has_research_designation = yes
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep
            volatile_motes = @pw_building_upkeep_rare_1
            sr_living_metal = @pw_building_upkeep_rare_1
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    has_research_designation = yes
                }
            }
            energy = @pw_building_upkeep_discount
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder_empire_unique
    }

    # produces mult
    planet_modifier = {
        planet_jobs_engineering_research_produces_mult = @pw_building_research_upgrade_mod
        engineer_jobs_bonus_workforce_mult = 0.15
    }

    #Regular jobs
    inline_script = {
        script = jobs/politician_add
        AMOUNT = 200
    }
    #Gestalt Jobs
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_coordinator_add = 300
        }
    }

    # 1500 biologists
    inline_script = {
        script = jobs/engineers_add
        AMOUNT = 1500
    }

    #Ambition Bonus
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_jobs_engineering_research_produces_mult = @pw_building_research_mod
        }
    }

    on_built = {
        planet_event = { id = pw_wonder.450 }
    }

    ai_weight = {
        weight = 75
        modifier = {
            factor = 0
            buildings_has_motes = no
            owner = {
                OR = {
                    AND = {
                        country_uses_consumer_goods = yes
                        has_monthly_income = {
                            resource = consumer_goods
                            value < 5
                        }
                    }
                    AND = {
                        country_uses_consumer_goods = no
                        has_monthly_income = {
                            resource = minerals
                            value < 75
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_metal_vivarium }
            NOT = { has_building_construction = pw_building_metal_vivarium }
        }
        modifier = {
            factor = 2
            has_active_building = building_research_lab_1
        }
        modifier = {
            factor = 3
            OR = {
                has_active_building = building_research_lab_2
                has_active_building = building_research_lab_3
                has_district = district_hab_science
                has_district = district_rw_science
                pw_jobs_any_research = yes
            }
        }
        modifier = {
            factor = 5
            has_research_designation = yes
        }
        modifier = {
            factor = 1.25
            owner = {
                any_owned_planet = {
                    OR = {
                        has_active_building = pw_building_particle_supercollider
                        has_active_building = pw_building_domed_city
                        has_active_building = pw_building_secluded_sector
                    }
                }
            }
        }
        modifier = {
            factor = 0.75
            planet_size < 15
        }
        modifier = {
            factor = 1.5
            planet_size > 20
        }
        modifier = {
            factor = 1.5
            planet.owner = {
                is_specialist_subject_type = { TYPE = scholarium }
            }
        }
    }
}

####################################################################################################################
# MANUFACTURED STUFF
####################################################################################################################

pw_building_mantle_crucible = {
    base_buildtime = @pw_building_buildtime
    position_priority = 120
    category = manufacturing
    planet_limit = 1
    can_be_ruined = no

    building_sets = {
        government
        industrial
        foundry
        factory
    }

    prerequisites = {
        pw_tech_planetary_mantle_production
    }

    potential = {
        exists = owner
        NOT = { has_modifier = resort_colony }
        OR = {
            is_planet_class = pc_giga_frameworld
            NOT = { habitable_structure = yes }
        }
    }

    allow = {
        has_major_upgraded_capital = yes
        OR = {
            free_district_slots > 0 # Needs a free district to occupy
            hidden_trigger = { has_modifier = pw_mod_integrated_monuments } #Or corresponding mod
        }
        pw_can_build_planetary_wonder = yes #Check if there is space for the Wonder
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_mantle_crucible }
                }
            }
            minerals = @pw_building_cost_extra
        }
        upkeep = {
            trigger = {
                has_modifier = pw_mod_mantle_crucible_alloys
            }
            energy = @pw_building_upkeep
            volatile_motes = @pw_building_upkeep_rare_1
        }
        upkeep = {
            trigger = {
                has_modifier = pw_mod_mantle_crucible_consumer_goods
            }
            energy = @pw_building_upkeep
            rare_crystals = @pw_building_upkeep_rare_1
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = { country_uses_consumer_goods = no }
            }
            energy = @pw_building_upkeep
            volatile_motes = @pw_building_upkeep_rare_1
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = { country_uses_consumer_goods = yes }
                NOT = { has_modifier = pw_mod_mantle_crucible_alloys }
                NOT = { has_modifier = pw_mod_mantle_crucible_consumer_goods }
            }
            energy = @pw_building_upkeep
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                exists = planet.owner
                planet.owner = {
                    is_specialist_subject_type = { TYPE = prospectorium }
                }
            }
            energy = -2
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    destroy_trigger = {
        OR = {
            has_modifier = resort_colony
            AND = {
                habitable_structure = yes
                NOT = { is_planet_class = pc_giga_frameworld }
            }
        }
    }

    convert_to = {
        building_factory_2
        building_foundry_2
    }

    upgrades = {
        pw_building_titan_forge
        pw_building_industrial_hearth
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder
    }

    planet_modifier = {
        foundry_jobs_bonus_workforce_mult = 0.10
        artisan_jobs_bonus_workforce_mult = 0.10
    }

    #Decrease Habitability
    triggered_planet_modifier = {
        potential = { #If habitability is not fixed
            exists = owner
            is_ideal_planet_class = {
                who = owner
                status = no
            }
            owner = { NOT = { has_country_flag = pw_mantle_crucible_habitability_project_completed }}
        }
        pop_environment_tolerance = -0.20 #Decrease Habitability
    }

    #Alloys
    inline_script = {
        script = pw/jobs/foundry_add
        AMOUNT = value:pw_building_mantle_crucible_foundry_jobs
    }

    #Consumer Goods
    inline_script = {
        # normal script doesnt like putting a variable in the amount field so we put it in mult
        script = pw/jobs/factory_add
        OWNER_CONDITION = "country_uses_consumer_goods = yes"
        AMOUNT = value:pw_building_mantle_crucible_artisan_jobs
    }

    #Ambition Bonuses
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                has_edict = pw_wonders_beyond_ambition
            }
        }
        modifier = {
            planet_metallurgists_produces_mult = 0.05
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                country_uses_consumer_goods = yes
                has_edict = pw_wonders_beyond_ambition
            }
        }
        modifier = {
            planet_artisans_produces_mult = 0.05
        }
    }

    on_built = {
        planet_event = { id = pw_wonder.1300 }
    }

    ai_weight = {
        weight = 60
        modifier = {
            factor = 0
        }
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            exists = owner
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_mantle_crucible }
            NOT = { has_building_construction = pw_building_mantle_crucible }
        }
        modifier = {
            factor = 1.5
            exists = owner
            OR = {
                owner = { is_machine_empire = yes }
                owner = { is_lithoid_empire = yes }
            }
        }
        modifier = {
            factor = 3
            OR = {
                has_active_building = building_foundry_1
                has_active_building = building_foundry_2
                has_active_building = building_foundry_3

                has_active_building = building_factory_1
                has_active_building = building_factory_2
                has_active_building = building_factory_3
            }
        }
        modifier = {
            factor = 5
            OR = {
                has_designation = col_foundry
                has_designation = col_ecu_foundry
                has_designation = col_mac_foundry
                has_designation = col_hiv_foundry
                has_designation = col_factory
                has_designation = col_ecu_factory
                has_designation = col_mac_factory
            }
        }
        modifier = {
            factor = 2
            exists = owner
            owner = {
                has_monthly_income = {
                    resource = alloys
                    value < 100
                }
            }
        }
        modifier = {
            factor = 2
            exists = owner
            owner = {
                has_monthly_income = {
                    resource = consumer_goods
                    value < 10
                }
            }
        }
        modifier = {
            factor = 2
            planet.owner = {
                is_specialist_subject_type = { TYPE = prospectorium }
            }
        }
    }
}

pw_building_titan_forge = {
    base_buildtime = @pw_building_buildtime
    position_priority = 100
    category = manufacturing
    can_be_ruined = no
    planet_limit = 1
    can_build = no #Only upgrades

    building_sets = {
        government
        industrial
        foundry
    }

    prerequisites = {
        pw_tech_titan_forge
    }

    potential = {
        exists = owner
        NOT = { has_modifier = resort_colony }
        OR = {
            is_planet_class = pc_giga_frameworld
            NOT = { habitable_structure = yes }
        }
    }

    allow = {
        #Upgrade Wonders don't check for districts or availability
        has_major_upgraded_capital = yes

        # Empire Unique:
        pw_is_wonder_empire_unique = { WONDER = pw_building_titan_forge }
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost
            volatile_motes = @pw_building_cost_rare
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_mantle_crucible }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    OR = {
                        has_designation = col_foundry
                        has_designation = col_ecu_foundry
                        has_designation = col_hiv_foundry
                        has_designation = col_mac_foundry
                        has_designation = col_habitat_foundry
                    }
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep_expensive
            volatile_motes = @pw_building_upkeep_rare_1
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    OR = {
                        has_designation = col_foundry
                        has_designation = col_ecu_foundry
                        has_designation = col_hiv_foundry
                        has_designation = col_mac_foundry
                        has_designation = col_habitat_foundry
                    }
                }
            }
            energy = @pw_building_upkeep_discount
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    destroy_trigger = {
        OR = {
            has_modifier = resort_colony
            AND = {
                habitable_structure = yes
                NOT = { is_planet_class = pc_giga_frameworld }
            }
        }
    }

    convert_to = {
        building_foundry_2
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder_empire_unique
    }

    planet_modifier = {
        foundry_jobs_bonus_workforce_mult = 0.20
    }

    triggered_planet_modifier = {
        potential = { #If habitability is not fixed
            exists = owner
            is_ideal_planet_class = {
                who = owner
                status = no
            }
            owner = { NOT = { has_country_flag = pw_mantle_crucible_habitability_project_completed }}
        }
        pop_environment_tolerance = -0.25 #Decrease Habitability
    }

    #ADMs
    inline_script = {
        script = jobs/politician_add
        AMOUNT = 100
    }

    #Alloys
    inline_script = {
        script = pw/jobs/foundry_add
        OWNER_CONDITION = ""
        AMOUNT = value:pw_building_titan_forge_foundry_jobs
    }

    #Machine
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_machine_empire = yes }
        }
        modifier = {
            job_replicator_add = 100
        }
    }

    #Ambition Bonus
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                has_edict = pw_wonders_beyond_ambition
            }
        }
        modifier = {
            planet_metallurgists_produces_mult = 0.15
            planet_metallurgists_upkeep_mult = 0.10
        }
    }

    on_built = {
        #This is an upgrade, so on_building_upgraded triggers for this.
        planet_event = { id = pw_wonder.1330 }
    }

    ai_weight = {
        weight = 80
        modifier = {
            factor = 0
        }
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            exists = owner
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_titan_forge }
            NOT = { has_building_construction = pw_building_titan_forge }
        }
        modifier = {
            factor = 2
            exists = owner
            OR = {
                owner = { is_machine_empire = yes }
            }
        }
        modifier = {
            factor = 3
            OR = {
                has_active_building = building_foundry_1
                has_active_building = building_foundry_2
                has_active_building = building_foundry_3
            }
        }
        modifier = {
            factor = 5
            OR = {
                has_designation = col_foundry
                has_designation = col_ecu_foundry
                has_designation = col_mac_foundry
                has_designation = col_hiv_foundry
            }
        }
        modifier = {
            factor = 2
            exists = owner
            owner = {
                has_monthly_income = {
                    resource = alloys
                    value < 100
                }
            }
        }
    }
}

pw_building_industrial_hearth = {
    base_buildtime = @pw_building_buildtime
    position_priority = 100
    category = manufacturing
    can_be_ruined = no
    planet_limit = 1
    can_build = no #Only upgrades

    building_sets = {
        government
        factory
        industrial
    }

    prerequisites = {
        pw_tech_industrial_hearth
    }

    potential = {
        exists = owner
        NOT = { has_modifier = resort_colony }
        OR = {
            is_planet_class = pc_giga_frameworld
            NOT = { habitable_structure = yes }
        }
        owner = { country_uses_consumer_goods = yes }
    }

    allow = {
        #Upgrade Wonders don't check for districts or availability
        has_major_upgraded_capital = yes

        # Empire Unique:
        pw_is_wonder_empire_unique = { WONDER = pw_building_industrial_hearth }
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost
            rare_crystals = @pw_building_cost_rare
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_mantle_crucible }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    OR = {
                        has_designation = col_factory
                        has_designation = col_ecu_factory
                        has_designation = col_mac_factory
                        has_designation = col_habitat_factory
                    }
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep_expensive
            rare_crystals = @pw_building_upkeep_rare_1
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    OR = {
                        has_designation = col_factory
                        has_designation = col_ecu_factory
                        has_designation = col_mac_factory
                        has_designation = col_habitat_factory
                    }
                }
            }
            energy = @pw_building_upkeep_discount
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    destroy_trigger = {
        OR = {
            has_modifier = resort_colony
            AND = {
                habitable_structure = yes
                NOT = { is_planet_class = pc_giga_frameworld }
            }
            AND = {
                exists = owner
                owner = { country_uses_consumer_goods = no }
            }
        }
    }

    convert_to = {
        pw_building_mantle_crucible
        building_factory_2
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder_empire_unique
    }

    planet_modifier = {
        artisan_jobs_bonus_workforce_mult = 0.20
    }

    triggered_planet_modifier = {
        potential = { #If habitability is not fixed
            exists = owner
            is_ideal_planet_class = {
                who = owner
                status = no
            }
            owner = { NOT = { has_country_flag = pw_mantle_crucible_habitability_project_completed }}
        }
        pop_environment_tolerance = -0.25 #Decrease Habitability
    }

    inline_script = {
        script = jobs/factory_add
        AMOUNT = 800
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = no }
        }
        job_artisan_per_pop = @pw_job_per_25_pop
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                is_gestalt = yes
                country_uses_consumer_goods = yes
            }
        }
        job_artisan_drone_per_pop = @pw_job_per_25_pop
    }

    #Ambition Bonus
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = {
                has_edict = pw_wonders_beyond_ambition
            }
        }
        modifier = {
            planet_artisans_produces_mult = 0.15
            planet_artisans_upkeep_mult = 0.10
        }
    }

    on_built = {
        planet_event = { id = pw_wonder.1360 }
    }

    ai_weight = {
        weight = 80
        modifier = {
            factor = 0
        }
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            exists = owner
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_industrial_hearth }
            NOT = { has_building_construction = pw_building_industrial_hearth }
        }
        modifier = {
            factor = 3
            OR = {
                has_active_building = building_factory_1
                has_active_building = building_factory_2
                has_active_building = building_factory_3
            }
        }
        modifier = {
            factor = 5
            OR = {
                has_designation = col_factory
                has_designation = col_ecu_factory
                has_designation = col_mac_factory
            }
        }
        modifier = {
            factor = 2
            exists = owner
            owner = {
                has_monthly_income = {
                    resource = consumer_goods
                    value < 30
                }
            }
        }
    }
}

####################################################################################################################
# ARMY WONDERS
####################################################################################################################

pw_building_guardian_angel = {
    base_buildtime = @pw_building_buildtime
    position_priority = 50
    planetary_ftl_inhibitor = yes
    planet_limit = 1
    category = army
    can_be_ruined = no

    building_sets = {
        government
        fortress
    }

    prerequisites = {
        pw_tech_guardian_angel
    }

    potential = {
        exists = owner
        NOT = { has_modifier = resort_colony }
        OR = {
            NOT = { merg_is_habitat = yes }
            owner = { is_void_dweller_empire = yes }
        }
    }

    destroy_trigger = {
        has_modifier = resort_colony
    }

    convert_to = {
        building_dread_encampment
        building_military_academy
        building_fortress
    }

    upgrades = {
        pw_building_stellar_sentinel
    }

    allow = {
        has_major_upgraded_capital = yes
        OR = {
            free_district_slots > 0 # Needs a free district to occupy
            hidden_trigger = { has_modifier = pw_mod_integrated_monuments } #Or corresponding mod
        }
        pw_can_build_planetary_wonder = yes #Check if there is space for the Wonder
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost
            volatile_motes = @pw_building_cost_rare
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_guardian_angel }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    has_fortress_designation = yes
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep
            volatile_motes = @pw_building_upkeep_rare_1
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    has_fortress_designation = yes
                }
            }
            energy = @pw_building_upkeep_discount
        }
        upkeep = {
            trigger = {
                exists = planet.owner
                planet.owner = {
                    is_specialist_subject_type = { TYPE = bulwark }
                }
            }
            energy = -2
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder
    }


    army_modifier = {
        army_starting_experience_add = 200
    }

    #Individual
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_regular_empire = yes }
        }
        modifier = {
            job_soldier_add = 500
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_regular_empire = yes }
            owner = {
                NOR = {
                    has_active_tradition = tr_psionics_psi_corps
                    has_active_tradition = tr_psionics_shroud_psi_corps
                }
            }
        }
        modifier = {
            job_enforcer_add = 200
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_regular_empire = yes }
            owner = {
                OR = {
                    has_active_tradition = tr_psionics_psi_corps
                    has_active_tradition = tr_psionics_shroud_psi_corps
                }
            }
        }
        modifier = {
            job_telepath_add = 100
        }
    }

    #Gestalt Jobs
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_warrior_drone_add = 500
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
            owner = {
                NOR = {
                    has_active_tradition = tr_psionics_psi_corps
                    has_active_tradition = tr_psionics_shroud_psi_corps
                }
            }
        }
        modifier = {
            job_patrol_drone_add = 200
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
            owner = {
                OR = {
                    has_active_tradition = tr_psionics_psi_corps
                    has_active_tradition = tr_psionics_shroud_psi_corps
                }
            }
        }
        modifier = {
            job_telepath_drone_add = 100
        }
    }


    #Ambitions Bonus
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_orbital_bombardment_damage = -0.10
        }
    }

    triggered_desc = {
        text = pw_guardian_angel_tooltip
    }

    on_built = {
        planet_event = { id = pw_wonder.1200 }
    }

    ai_weight = {
        weight = 40
        modifier = {
            factor = 0
            buildings_has_motes = no
        }
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_guardian_angel }
            NOT = { has_building_construction = pw_building_guardian_angel }
        }
        modifier = {
            factor = 2
            owner = { used_naval_capacity_percent > 0.8	}
        }
        modifier = {
            factor = 2
            owner = { used_naval_capacity_percent > 0.9	}
        }
        modifier = {
            factor = 2
            planet_crime > 10
        }
        modifier = {
            factor = 1.25
            OR = {
                owner = { is_militarist = yes }
                owner = { is_gestalt = yes }
            }
        }
        modifier = {
            factor = 1.5
            owner = { is_homicidal = yes }
        }
        modifier = {
            factor = 3
            owner = { is_at_war = yes }
        }
        modifier = {
            factor = 10
            colony_type = col_fortress
        }
        modifier = {
            factor = 2
            planet.owner = {
                is_specialist_subject_type = { TYPE = bulwark }
            }
        }
    }
}

pw_building_stellar_sentinel = {
    base_buildtime = @pw_building_buildtime
    position_priority = 45
    planetary_ftl_inhibitor = yes
    can_build = no #Only upgrades
    category = army

    building_sets = {
        government
        fortress
    }

    prerequisites = {
        pw_tech_stellar_sentinel
    }

    potential = {
        exists = owner
        NOT = { has_modifier = resort_colony }
        OR = {
            NOT = { merg_is_habitat = yes }
            owner = { is_void_dweller_empire = yes }
        }
    }

    allow = {
        has_major_upgraded_capital = yes
        #Upgrade Wonders don't need to check for availability

        # Sector Unique:
        pw_is_wonder_sector_unique = { WONDER = pw_building_stellar_sentinel }
    }

    destroy_trigger = {
        has_modifier = resort_colony
    }

    convert_to = {
        building_dread_encampment
        building_military_academy
        building_fortress
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost
            volatile_motes = @pw_building_cost_rare_upgrade
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_stellar_sentinel }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    has_fortress_designation = yes
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep
            volatile_motes = @pw_building_upkeep_rare_2
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    has_fortress_designation = yes
                }
            }
            energy = @pw_building_upkeep_discount
        }
        upkeep = {
            trigger = {
                exists = planet.owner
                planet.owner = {
                    is_specialist_subject_type = { TYPE = bulwark }
                }
            }
            energy = -2
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder
    }

    army_modifier = {
        army_starting_experience_add = 300
    }

    country_modifier = {
        country_naval_cap_add = 25
    }

    #Individual
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_regular_empire = yes }
        }
        modifier = {
            job_soldier_add = 500
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_regular_empire = yes }
            owner = {
                NOR = {
                    has_active_tradition = tr_psionics_psi_corps
                    has_active_tradition = tr_psionics_shroud_psi_corps
                }
            }
        }
        modifier = {
            job_enforcer_add = 200
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_regular_empire = yes }
            owner = {
                OR = {
                    has_active_tradition = tr_psionics_psi_corps
                    has_active_tradition = tr_psionics_shroud_psi_corps
                }
            }
        }
        modifier = {
            job_telepath_add = 100
        }
    }

    #Gestalt Jobs
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_warrior_drone_add = 500
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
            owner = {
                NOR = {
                    has_active_tradition = tr_psionics_psi_corps
                    has_active_tradition = tr_psionics_shroud_psi_corps
                }
            }
        }
        modifier = {
            job_patrol_drone_add = 200
        }
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
            owner = {
                OR = {
                    has_active_tradition = tr_psionics_psi_corps
                    has_active_tradition = tr_psionics_shroud_psi_corps
                }
            }
        }
        modifier = {
            job_telepath_drone_add = 100
        }
    }

    #Ambitions Bonus
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_orbital_bombardment_damage = -0.15
        }
    }

    triggered_desc = {
        text = pw_sector_unique_lb
    }

    triggered_desc = {
        text = pw_guardian_angel_tooltip
    }

    on_built = {
        planet_event = { id = pw_wonder.1250 }
    }

    ai_weight = {
        weight = 25
        modifier = {
            factor = 0
            buildings_has_motes = no
        }
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_stellar_sentinel }
            NOT = { has_building_construction = pw_building_stellar_sentinel }
        }
        modifier = {
            factor = 2
            owner = { used_naval_capacity_percent > 0.8	}
        }
        modifier = {
            factor = 2
            owner = { used_naval_capacity_percent > 0.9	}
        }
        modifier = {
            factor = 2
            planet_crime > 10
        }
        modifier = {
            factor = 1.25
            OR = {
                owner = { is_militarist = yes }
                owner = { is_gestalt = yes }
            }
        }
        modifier = {
            factor = 1.5
            owner = { is_homicidal = yes }
        }
        modifier = {
            factor = 3
            owner = { is_at_war = yes }
        }
        modifier = {
            factor = 10
            colony_type = col_fortress
        }
        modifier = {
            factor = 2
            planet.owner = {
                is_specialist_subject_type = { TYPE = bulwark }
            }
        }
    }
}

####################################################################################################################
# GALACTIC MODEL
####################################################################################################################

pw_building_galactic_model = {
    base_buildtime = @pw_building_buildtime
    position_priority = 100
    planet_limit = 1
    can_be_ruined = no
    category = government
    # empire_limit = {
    # 	modifier = {
    # 		add = 1
    # 	}
    # }

    building_sets = {
        government
        urban
    }

    prerequisites = {
        pw_tech_galactic_modeling
    }

    potential = {
        exists = owner
        NOT = { has_modifier = resort_colony }
        NOT = { has_modifier = slave_colony }
        OR = {
            NOT = { merg_is_habitat = yes }
            owner = { is_void_dweller_empire = yes }
        }
    }

    allow = {
        has_major_upgraded_capital = yes
        OR = {
            free_district_slots > 0 # Needs a free district to occupy
            hidden_trigger = { has_modifier = pw_mod_integrated_monuments } #Or corresponding mod
        }
        pw_can_build_planetary_wonder = yes #Check if there is space for the Wonder

        # Empire Unique:
        AND = {
            pw_is_wonder_empire_unique = { WONDER = pw_building_galactic_model }
            hidden_trigger = { pw_is_wonder_empire_unique = { WONDER = pw_building_aligned_galactic_model }}
        }
    }

    destroy_trigger = {
        OR = {
            has_modifier = slave_colony
            has_modifier = resort_colony
        }
    }

    upgrades = {
        pw_building_aligned_galactic_model
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost
            rare_crystals = @pw_building_cost_rare
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_galactic_model }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_designation_galactic_model = yes
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep
            rare_crystals = @pw_building_upkeep_rare_1
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_designation_galactic_model = yes
                }
            }
            energy = @pw_building_upkeep_discount
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder_empire_unique
    }

    country_modifier = {
        diplomacy_upkeep_mult = -0.25
    }


    # INDIVIDUAL
    inline_script = {
        script = jobs/politician_add
        AMOUNT = 100
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = no }
        }
        modifier = {
            job_bureaucrat_per_pop = 0.04
        }
    }

    #Gestalt
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_coordinator_add = 250
            job_coordinator_per_pop = 0.04
        }
    }

    #Ambition Bonus
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_bureaucrats_produces_mult = 0.10
            planet_bureaucrats_upkeep_mult = -0.10
        }
    }

    on_built = {
        planet_event = { id = pw_wonder.800 }
    }

    ai_weight = {
        weight = 60
        modifier = {
            factor = 0
            buildings_has_crystals = no
            owner = {
                OR = {
                    AND = {
                        is_regular_empire = yes
                        has_monthly_income = {
                            resource = consumer_goods
                            value > 5
                        }
                    }
                    AND = {
                        is_regular_empire = no
                        has_monthly_income = {
                            resource = minerals
                            value > 75
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_galactic_model }
            NOT = { has_building_construction = pw_building_galactic_model }
        }
        modifier = {
            factor = owner.trigger:empire_sprawl_over_cap
        }
        modifier = {
            factor = 2
            owner = { has_valid_civic = civic_byzantine_bureaucracy }
        }
        modifier = {
            factor = 1.5
            has_active_building = building_bureaucratic_1
        }
        modifier = {
            factor = 2
            has_active_building = building_bureaucratic_2
        }
        modifier = {
            factor = value:pw_pop_factor
        }
        modifier = {
            factor = 5
            OR = {
                colony_type = col_bureau
                colony_type = col_bureau_hive
                colony_type = col_bureau_machine
                colony_type = col_bureau_spiritualist
            }
        }
    }
}

pw_building_aligned_galactic_model = {
    base_buildtime = @pw_building_buildtime
    position_priority = 95
    can_build = no #Only upgrades
    can_be_ruined = no
    category = government

    building_sets = {
        government
        urban
    }

    prerequisites = {
        pw_tech_hyperreality_modeling
    }

    potential = {
        exists = owner
        NOT = { has_modifier = resort_colony }
        NOT = { has_modifier = slave_colony }
        OR = {
            NOT = { merg_is_habitat = yes }
            owner = { is_void_dweller_empire = yes }
        }
    }

    allow = {
        has_major_upgraded_capital = yes
        #Upgrade Wonders don't need to check for availability

        # Empire Unique:
        pw_is_wonder_empire_unique = { WONDER = pw_building_aligned_galactic_model }
    }

    destroy_trigger = {
        OR = {
            has_modifier = slave_colony
            has_modifier = resort_colony
        }
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost_upgrade
            rare_crystals = @pw_building_cost_rare_upgrade
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_aligned_galactic_model }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_designation_galactic_model = yes
                }
            }
            minerals = @pw_building_cost_discount
        }
        produces = {
            influence = 1
        }
        upkeep = {
            energy = @pw_building_upkeep
            rare_crystals = @pw_building_upkeep_rare_2
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_designation_galactic_model = yes
                }
            }
            energy = @pw_building_upkeep_discount
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder_empire_unique
    }

    country_modifier = {
        diplomacy_upkeep_mult = -0.30
        country_edict_fund_add = 50
    }






    # INDIVIDUAL
    inline_script = {
        script = jobs/politician_add
        AMOUNT = 100
    }
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = no }
        }
        modifier = {
            job_bureaucrat_add = 800
            job_bureaucrat_per_pop = 0.04
        }
    }

    #Gestalt
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_coordinator_add = 1050
            job_logistics_drone_add = 200
            job_coordinator_per_pop = 0.04
            job_evaluator_add = 200
        }
    }

    #Ambition Bonus
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_bureaucrats_produces_mult = 0.15
            planet_bureaucrats_upkeep_mult = -0.15
        }
    }

    on_built = {
        planet_event = { id = pw_wonder.850 }
    }

    ai_weight = {
        weight = 65
        modifier = {
            factor = 0
            buildings_has_crystals = no
            owner = {
                OR = {
                    AND = {
                        is_regular_empire = yes
                        has_monthly_income = {
                            resource = consumer_goods
                            value > 5
                        }
                    }
                    AND = {
                        is_regular_empire = no
                        has_monthly_income = {
                            resource = minerals
                            value > 75
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_aligned_galactic_model }
            NOT = { has_building_construction = pw_building_aligned_galactic_model }
        }
        modifier = {
            factor = owner.trigger:empire_sprawl_over_cap
        }
        modifier = {
            factor = 2
            owner = { has_valid_civic = civic_byzantine_bureaucracy }
        }
        modifier = {
            factor = 1.5
            has_active_building = building_bureaucratic_1
        }
        modifier = {
            factor = 2
            has_active_building = building_bureaucratic_2
        }
        modifier = {
            factor = value:pw_pop_factor
        }
        modifier = {
            factor = 8
            OR = {
                colony_type = col_bureau
                colony_type = col_bureau_hive
                colony_type = col_bureau_machine
                colony_type = col_bureau_spiritualist
            }
        }
    }
}

####################################################################################################################
# SPACE ELEVATOR
####################################################################################################################

pw_building_space_elevator = {
    base_buildtime = @pw_building_buildtime
    position_priority = 85
    planet_limit = 1
    can_be_ruined = no
    category = trade

    building_sets = {
        government
        urban
        trade
    }

    prerequisites = {
        pw_tech_space_elevator
    }

    potential = {
        exists = owner
        NOT = { has_modifier = slave_colony }
        # At Stellaris 3.13, trade buildings can't be built on Penal Colony.
        NOT = { has_modifier = penal_colony }

        NOT = { merg_is_habitat = yes }
        NOT = { merg_is_hab_ringworld = yes }
    }

    allow = {
        has_major_upgraded_capital = yes
        OR = {
            free_district_slots > 0 # Needs a free district to occupy
            hidden_trigger = { has_modifier = pw_mod_integrated_monuments } #Or corresponding mod
        }
        pw_can_build_planetary_wonder = yes #Check if there is space for the Wonder
    }

    destroy_trigger = {
        has_modifier = slave_colony
        # At Stellaris 3.13, trade buildings can't be built on Penal Colony.
        has_modifier = penal_colony
    }

    convert_to = {
        building_commercial_zone
    }

    resources = {
        category = planet_buildings
        cost = {
            minerals = @pw_building_cost
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_any_planetary_wonder = yes
                    NOT = { has_building_construction = pw_building_space_elevator }
                }
            }
            minerals = @pw_building_cost_extra
        }
        cost = {
            trigger = {
                planet = {
                    pw_has_designation_space_elevator = yes
                }
            }
            minerals = @pw_building_cost_discount
        }
        upkeep = {
            energy = @pw_building_upkeep
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_any_additional_planetary_wonder = yes
                }
            }
            energy = @pw_building_upkeep_extra
        }
        upkeep = {
            trigger = {
                exists = owner
                owner = {
                    has_edict = pw_wonders_beyond_ambition
                }
            }
            energy = @pw_building_upkeep_ambition
        }
        upkeep = {
            trigger = {
                planet = {
                    pw_has_designation_space_elevator = yes
                }
            }
            energy = @pw_building_upkeep_discount
        }
        produces = {
            trigger = {
                exists = owner
                owner = { has_tradition = tr_pw_monumentality_architecture_parlante }
            }
            unity = @pw_unity_production
        }
    }

    #base wonder stuff
    inline_script = {
        script = pw/general_wonder
    }

    #Regular Jobs
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_regular_empire = yes }
        }
        modifier = {
            job_enforcer_add = 100
            job_clerk_add = 1000
            planet_traders_produces_mult = 0.05
        }
    }
    inline_script = {
        script = jobs/politician_add
        AMOUNT = 100
    }
    #trader from tech
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_regular_empire = yes }
            owner = { has_technology = pw_tech_space_elevator_orbital_commerce }
        }
        modifier = {
            job_trader_per_pop = @pw_job_per_50_pop
        }
    }

    #gestalt
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
        }
        modifier = {
            job_logistics_drone_add = 500
            job_patrol_drone_add = 100
            job_coordinator_add = 100
            planet_amenities_no_happiness_mult = 0.05
        }
    }
    #Logistics Drones from tech
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_technology = pw_tech_space_elevator_orbital_logistics }
        }
        modifier = {
            job_logistics_drone_per_pop = @pw_job_per_50_pop
        }
    }

    #Policy bonuses (non-Gestalt):
    #Trade
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_policy_flag = pw_policy_orbital_commerce_interplanetary_customhouses }
        }
        modifier = {
            planet_traders_produces_mult = 0.15
        }
    }
    #Amenities
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_policy_flag = pw_policy_orbital_commerce_exotic_goods_importer }
        }
        modifier = {
            planet_amenities_mult = 0.10
        }
    }
    #Unity
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_policy_flag = pw_policy_orbital_commerce_cultural_agencies }
        }
        modifier = {
            planet_jobs_unity_produces_mult = 0.10
        }
    }
    #Crime
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_policy_flag = pw_policy_orbital_commerce_border_control }
        }
        modifier = {
            planet_crime_add = -25
        }
    }
    #Emigration
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_policy_flag = pw_policy_orbital_commerce_relocation_offices }
        }
        modifier = {
            planet_resettlement_unemployed_mult = 0.50
        }
    }
    #Immigration
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_policy_flag = pw_policy_orbital_commerce_migration_bureau }
        }
        modifier = {
            planet_resettlement_unemployed_destination_mult = 0.25
        }
    }

    #Branch office value
    triggered_planet_modifier = {
        potential = {
            has_branch_office = yes
            exists = branch_office_owner
            branch_office_owner = { has_policy_flag = pw_policy_orbital_commerce_foreign_traders }
        }
        modifier = {
            branch_office_value_mult = 0.25
        }
    }
    #Branch office crime
    triggered_planet_modifier = {
        potential = {
            has_branch_office = yes
            exists = branch_office_owner
            branch_office_owner = { has_policy_flag = pw_policy_orbital_commerce_smuggling_contacts }
        }
        modifier = {
            planet_crime_add = 50
        }
    }

    #Policy bonuses (Gestalt):
    #Amenities
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_policy_flag = pw_policy_orbital_logistics_drone_care }
        }
        modifier = {
            planet_amenities_no_happiness_mult = 0.10
        }
    }
    #Crime
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_policy_flag = pw_policy_orbital_logistics_drone_scan }
        }
        modifier = {
            planet_crime_no_happiness_add = -25
        }
    }
    #Unity
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_policy_flag = pw_policy_orbital_logistics_gestalt_pylon }
        }
        modifier = {
            planet_jobs_unity_produces_mult = 0.10
        }
    }
    #Job Upkeep
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { has_policy_flag = pw_policy_orbital_logistics_production_supply }
        }
        modifier = {
            planet_jobs_upkeep_mult = -0.05
        }
    }

    #Ambition Bonuses
    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = no }
            owner = { has_edict = pw_wonders_beyond_ambition }

        }
        modifier = {
            planet_amenities_mult = 0.05
            planet_traders_produces_mult = 0.05
        }
    }

    triggered_planet_modifier = {
        potential = {
            exists = owner
            owner = { is_gestalt = yes }
            owner = { has_edict = pw_wonders_beyond_ambition }
        }
        modifier = {
            planet_amenities_no_happiness_mult = 0.05
            planet_jobs_upkeep_mult = -0.05
        }
    }


    on_built = {
        planet_event = { id = pw_wonder.100 }
    }

    ai_weight = {
        weight = 30
        modifier = {
            factor = 0.25
            free_building_slots < 1
            free_district_slots < 1
        }
        modifier = {
            factor = 0.25
            pw_has_any_planetary_wonder = yes
            NOT = { owner = { has_ascension_perk = pw_ap_planetary_wonders }}
            NOT = { has_active_building = pw_building_space_elevator }
            NOT = { has_building_construction = pw_building_space_elevator }
        }
        modifier = {
            factor = 2
            has_active_building = building_commercial_zone
        }
        modifier = {
            factor = 2.5
            has_active_building = building_commercial_megaplex
        }
        modifier = {
            factor = 1.25
            OR = {
                has_active_building = building_holo_theatres
                has_active_building = building_temple
                has_active_building = building_sacrificial_temple_1
                AND = {
                    exists = planet.branch_office_owner
                    has_holding = {
                        holding = building_temple_of_prosperity
                        owner = planet.branch_office_owner
                    }
                }
            }
        }
        modifier = {
            factor = 1.75
            OR = {
                has_active_building = building_hyper_entertainment_forum
                has_active_building = building_holotemple
                has_active_building = building_sacrificial_temple_2
            }
        }
        modifier = {
            factor = 2
            OR = {
                has_active_building = building_sacred_nexus
                has_active_building = building_sacrificial_temple_3
            }
        }
        modifier = {
            factor = 5
            exists = owner
            owner = {
                is_megacorp = yes
            }
        }
        modifier = {
            factor = value:pw_pop_factor
        }
        # modifier = {
        # 	factor = value:pw_trade_factor
        # }
    }
}
